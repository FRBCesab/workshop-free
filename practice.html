<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span. { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Functional Rarity and Diversity in Ecology: Practice</title>
  
  
  <link rel="icon" type="image/vnd.microsoft.icon" href="img/favicon.ico"/>
  
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Functional Rarity and Diversity in Ecology: Practice"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Functional Rarity and Diversity in Ecology"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Functional Rarity and Diversity in Ecology: Practice"/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","output"]}},"value":[{"type":"character","attributes":{},"value":["Practice"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>
  
  <script type="application/javascript">
  
    window.headroom_prevent_pin = false;
  
    window.document.addEventListener("DOMContentLoaded", function (event) {
  
      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');
  
      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });
  
      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });
  
      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>
  
  <style type="text/css">
  
  /* Theme (user-documented overrideables for nav appearance) */
  
  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }
  
  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }
  
  .distill-site-nav a:hover {
    color: white;
  }
  
  @media print {
    .distill-site-nav {
      display: none;
    }
  }
  
  .distill-site-header {
  
  }
  
  .distill-site-footer {
  
  }
  
  
  /* Site Header */
  
  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }
  
  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }
  
  
  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }
  
  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }
  
  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }
  
  .distill-site-header .logo {
    padding: 0;
  }
  
  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }
  
  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }
  
  
  
  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }
  
  
  .distill-site-header .nav-toggle {
    display: none;
  }
  
  .nav-dropdown {
    display: inline-block;
    position: relative;
  }
  
  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }
  
  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }
  
  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .nav-dropdown-active {
    display: block;
  }
  
  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }
  
  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }
  
  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }
  
  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }
  
  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }
  
  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }
  
  /* Site Footer */
  
  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }
  
  /* Headroom */
  
  d-title {
    padding-top: 6rem;
  }
  
  @media print {
    d-title {
      padding-top: 4rem;
    }
  }
  
  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
  
  .headroom--transition {
    transition: all .4s ease-in-out;
  }
  
  .headroom--unpinned {
    top: -100px;
  }
  
  .headroom--pinned {
    top: 0;
  }
  
  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }
  
  </style>
  
  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>
  
  <script type="application/javascript">
  
  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }
  
  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }
  
  function createFuseIndex() {
  
    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);
  
    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });
  
        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }
  
  window.document.addEventListener("DOMContentLoaded", function (event) {
  
    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;
  
    createFuseIndex()
      .then(function(fuse) {
  
        // make search box visible
        searchEl.classList.remove('hidden');
  
        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });
  
  });
  
  </script>
  
  <style type="text/css">
  
  .nav-search {
    font-size: x-small;
  }
  
  /* Algolioa Autocomplete */
  
  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }
  
  
  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }
  
  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }
  
  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }
  
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }
  
  </style>
  
  
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }
  
  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }
  
  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }
  
  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }
  
  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }
  
  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }
  
  d-article h3 {
    margin-top: 1.5rem;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  /* Tweak code blocks */
  
  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }
  
  d-article div.sourceCode {
    background-color: white;
  }
  
  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  d-article pre a {
    border-bottom: none;
  }
  
  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }
  
  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }
  
  @media(min-width: 768px) {
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }
  
  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }
  
  d-article pre {
    font-size: 14px;
  }
  
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for d-contents */
  
  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }
  
  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }
  
  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }
  
  .d-contents li {
    list-style-type: none
  }
  
  .d-contents nav > ul {
    padding-left: 0;
  }
  
  .d-contents ul {
    padding-left: 1em
  }
  
  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }
  
  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }
  
  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }
  
  .d-contents nav > ul > li > a {
    font-weight: 600;
  }
  
  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }
  
  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }
  
  
  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }
  
  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }
  
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  /* Citations */
  
  d-article .citation {
    color: inherit;
    cursor: inherit;
  }
  
  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }
  
  /* Citation hover box */
  
  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }
  
  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Include appendix styles here so they can be overridden */
  
  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }
  
  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }
  
  d-appendix h3 + * {
    margin-top: 1em;
  }
  
  d-appendix ol {
    padding: 0 0 0 15px;
  }
  
  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }
  
  d-appendix li {
    margin-bottom: 1em;
  }
  
  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  d-appendix > * {
    grid-column: text;
  }
  
  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }
  
  /* Include footnote styles here so they can be overridden */
  
  d-footnote-list {
    contain: layout style;
  }
  
  d-footnote-list > * {
    grid-column: text;
  }
  
  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }
  
  
  
  /* Anchor.js */
  
  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .custom p {
    margin-bottom: 0.5em;
  }
  
  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }
  
  /* Styles for posts lists (not auto-injected) */
  
  
  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }
  
  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }
  
  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }
  
  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }
  
  .post-preview-last {
    border-bottom: none !important;
  }
  
  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }
  
  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }
  
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }
  
  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }
  
  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }
  
  .posts-list .metadata > * {
    display: inline-block;
  }
  
  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }
  
  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }
  
  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }
  
  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  .posts-list img {
    opacity: 1;
  }
  
  .posts-list img[data-src] {
    opacity: 0;
  }
  
  .posts-more {
    clear: both;
  }
  
  
  .posts-sidebar {
    font-size: 16px;
  }
  
  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }
  
  .sidebar-section {
    margin-bottom: 30px;
  }
  
  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
  
  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }
  
  .categories li>a {
    border-bottom: none;
  }
  
  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }
  
  .categories .active {
    font-weight: 600;
  }
  
  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }
  
  
  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  .downlevel .posts-list .post-preview {
    color: inherit;
  }
  
  
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }
  
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();
  
    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // hoverable references
      $('span.citation[data-cites]').each(function() {
        if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
          var fn = $(this).children()[0]
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });
  
      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }
  
              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-contents').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <link href="site_libs/font-awesome-5.15.3/css/all.min.css" rel="stylesheet" />
  <link href="site_libs/font-awesome-5.15.3/css/v4-shims.min.css" rel="stylesheet" />
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Practice","authors":[]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://frbcesab.github.io/workshop-free/">
<img src="img/Rlogo.png" alt="Logo"/>
</a>
<a href="index.html" class="title">Functional Rarity and Diversity in Ecology</a>
</div>
<div class="nav-right">
<a href="index.html">
<i class="fa fa-home" aria-hidden="true"></i>
</a>
<a href="instructions.html">Instructions</a>
<a href="">Courses</a>
<a href="practice.html">Practice</a>
<a href="resources.html">Resources</a>
<a href="https://github.com/frbcesab/workshop-free/">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Practice</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>


<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#about">About</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#data-description">Data description</a></li>
<li><a href="#questions">Questions</a></li>
<li><a href="#part-1.-build-a-functional-space-using-the-mfd-package">Part 1. Build a functional space using the <code>mFD</code> package</a><ul>
<li><a href="#compute-summaries-about-your-data">1.0. Compute summaries about your data</a></li>
<li><a href="#what-about-the-traits">1.1. What about the traits?</a></li>
<li><a href="#computing-distances-between-species-based-on-functional-traits">1.2. Computing distances between species based on functional traits</a></li>
<li><a href="#building-functional-spaces-and-chosing-the-best-one">1.3. Building functional spaces and chosing the best one</a><ul>
<li><a href="#computing-several-multimensional-functional-spaces-and-assessing-their-quality">1.3.1. Computing several multimensional functional spaces and assessing their quality</a></li>
<li><a href="#illustrating-the-quality-of-the-functional-spaces">1.3.2. Illustrating the quality of the functional spaces</a></li>
<li><a href="#testing-the-correlation-between-functional-axes-and-traits">1.3.3. Testing the correlation between functional axes and traits</a></li>
</ul></li>
<li><a href="#plotting-the-selected-functional-space-and-position-of-species">1.4. Plotting the selected functional space and position of species</a></li>
</ul></li>
<li><a href="#part-2.-computing-and-plotting-fd-indices-using-the-mfd-package">Part 2. Computing and plotting FD indices using the <code>mFD</code> package</a><ul>
<li><a href="#computing-and-plotting-alpha-fd-indices">2.1. Computing and plotting alpha FD indices</a></li>
<li><a href="#computing-and-plotting-beta-fd-indices">2.2. Computing and plotting beta FD indices</a></li>
</ul></li>
<li><a href="#part-3.-functional-rarity">Part 3. Functional rarity</a><ul>
<li><a href="#components-of-functional-rarity-trait-originality-and-rarity">3.1 Components of functional rarity: trait originality and rarity</a></li>
<li><a href="#different-indices-of-functional-originality">3.2 Different indices of functional originality</a></li>
<li><a href="#computing-functional-originality">3.3 Computing functional originality</a><ul>
<li><a href="#at-regional-scale">3.3.1 At regional scale</a></li>
<li><a href="#at-local-scale">3.3.2 At local scale</a></li>
</ul></li>
<li><a href="#plotting-functional-originality">3.4 Plotting functional originality</a></li>
</ul></li>
</ul>
</nav>
</div>
<h1 id="about">About</h1>
<p><br /></p>
<p>This tutorial describes the basic workflow showing how to compute step by step functional diversity (FD) indices in a multidimensional space. It is divided in three parts:</p>
<ol type="1">
<li>Computing trait-based distances and the multidimensional functional space</li>
<li>Using the <a href="https://github.com/CmlMagneville/mFD"><code>mFD</code></a> package to compute FD alpha and beta indices and plot them (<a href="https://doi.org/10.1111/ecog.05904">Magneville <em>et al.</em> 2021</a>)</li>
<li>Using the <a href="https://github.com/rekyt/funrar"><code>funrar</code></a> package to compute functional rarity indices (<a href="https://doi.org/10.1016/j.tree.2017.02.002">Violle <em>et al.</em> 2017</a>, <a href="https://doi.org/10.1111%2Fddi.12629">Grenié <em>et al.</em> 2017</a>)</li>
</ol>
<p><br /></p>
<p><strong>N.B.</strong> You can chose to do Part 2 and Part 3 in the order that you want but Part 1 has to be realized first.</p>
<p><br /></p>
<h1 id="prerequisites">Prerequisites</h1>
<p>Be sure you have followed the <a href="https://frbcesab.github.io/workshop-free/instructions.html"><strong>instructions</strong></a> to set up your system (e.g. <code>R version &gt;= 3.5</code>).</p>
<p>If not already done, please install the following R packages:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## CRAN packages ----</span>
<span class='va'>pkgs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"funrar"</span>, <span class='st'>"mFD"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/install.packages.html'>install.packages</a></span><span class='op'>(</span><span class='va'>pkgs</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p><br /></p>
<h1 id="data-description">Data description</h1>
<p>The dataset used as study case all along this workshop is the <strong>Fruits dataset</strong> based on 25 types of fruits (i.e. species) distributed in 10 fruits baskets (i.e. assemblages). Each fruit is characterized by five traits values summarized in the following table:</p>
<p><br /></p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Trait name</th>
<th style="text-align: center;">Trait measurement</th>
<th style="text-align: center;">Trait type</th>
<th style="text-align: center;">Number of classes</th>
<th style="text-align: center;">Classes code</th>
<th style="text-align: center;">Unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Size</td>
<td style="text-align: center;">Maximal diameter</td>
<td style="text-align: center;">Ordinal</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0-1 ; 1-3 ; 3-5 ; 5-10 ; 10-20</td>
<td style="text-align: center;">cm</td>
</tr>
<tr class="even">
<td style="text-align: center;">Plant</td>
<td style="text-align: center;">Growth form</td>
<td style="text-align: center;">Categorical</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">tree ; shrub ; vine ; forb</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Climate</td>
<td style="text-align: center;">Climatic niche</td>
<td style="text-align: center;">Ordinal</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">temperate ; subtropical ; tropical</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">Seed</td>
<td style="text-align: center;">Seed type</td>
<td style="text-align: center;">Ordinal</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">none ; pip ; pit</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sugar</td>
<td style="text-align: center;">Sugar</td>
<td style="text-align: center;">Continuous</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">g/kg</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>The use of the <code>mFD</code> and <code>funrar</code> packages is based on two datasets:</p>
<ul>
<li>a <strong><code>data.frame</code></strong> summarizing traits values for each species called <code>fruits_traits</code> in this tutorial</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Loading data ----</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"fruits_traits"</span>, package <span class='op'>=</span> <span class='st'>"mFD"</span><span class='op'>)</span>

<span class='co'>## Removing fuzzy traits in this tutorial ----</span>
<span class='va'>fruits_traits</span> <span class='op'>&lt;-</span> <span class='va'>fruits_traits</span><span class='op'>[</span> , <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span><span class='op'>:</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>]</span>

<span class='co'>## Display the table ----</span>
<span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>fruits_traits</span><span class='op'>)</span>,
             caption <span class='op'>=</span> <span class='st'>"Species x traits data.frame"</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<caption><span id="tab:unnamed-chunk-2">Table 1: </span>Species x traits data.frame</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Size</th>
<th style="text-align: left;">Plant</th>
<th style="text-align: left;">Climate</th>
<th style="text-align: left;">Seed</th>
<th style="text-align: right;">Sugar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">apple</td>
<td style="text-align: left;">5-10cm</td>
<td style="text-align: left;">tree</td>
<td style="text-align: left;">temperate</td>
<td style="text-align: left;">pip</td>
<td style="text-align: right;">103.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">apricot</td>
<td style="text-align: left;">3-5cm</td>
<td style="text-align: left;">tree</td>
<td style="text-align: left;">temperate</td>
<td style="text-align: left;">pit</td>
<td style="text-align: right;">92.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">banana</td>
<td style="text-align: left;">10-20cm</td>
<td style="text-align: left;">tree</td>
<td style="text-align: left;">tropical</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">122.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">currant</td>
<td style="text-align: left;">0-1cm</td>
<td style="text-align: left;">shrub</td>
<td style="text-align: left;">temperate</td>
<td style="text-align: left;">pip</td>
<td style="text-align: right;">73.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">blackberry</td>
<td style="text-align: left;">1-3cm</td>
<td style="text-align: left;">shrub</td>
<td style="text-align: left;">temperate</td>
<td style="text-align: left;">pip</td>
<td style="text-align: right;">48.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">blueberry</td>
<td style="text-align: left;">0-1cm</td>
<td style="text-align: left;">forb</td>
<td style="text-align: left;">temperate</td>
<td style="text-align: left;">pip</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
<p><br /></p>
<ul>
<li>a <strong><code>matrix</code></strong> summarizing species assemblages called <code>baskets_fruits_weights</code> in this tutorial. Weights in this matrix can be occurrence data, abundance, biomass, coverage, etc. The studied example works with biomass (<em>i.e.</em> grams of a fruit in a basket) and this matrix looks as follows:</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Loading data ----</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"baskets_fruits_weights"</span>, package <span class='op'>=</span> <span class='st'>"mFD"</span><span class='op'>)</span>

<span class='co'>## Display the table ----</span>
<span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>baskets_fruits_weights</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span><span class='op'>]</span><span class='op'>)</span>, 
             centering <span class='op'>=</span> <span class='cn'>TRUE</span>,
             caption <span class='op'>=</span> <span class='st'>"Species x assemblages matrix based on the **fruits** dataset"</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<caption><span id="tab:unnamed-chunk-3">Table 2: </span>Species x assemblages matrix based on the <strong>fruits</strong> dataset</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">apple</th>
<th style="text-align: right;">apricot</th>
<th style="text-align: right;">banana</th>
<th style="text-align: right;">currant</th>
<th style="text-align: right;">blackberry</th>
<th style="text-align: right;">blueberry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">basket_1</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">basket_2</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">basket_3</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">basket_4</td>
<td style="text-align: right;">300</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">basket_5</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">basket_6</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<h1 id="questions">Questions</h1>
<p>Using this Practice, we ask the following questions:</p>
<ul>
<li>How different are the fruits baskets based on their functional traits?</li>
<li><strong><em>{{ Question functional rarity }}</em></strong></li>
<li><strong><em>{{ Question funbiogeo }}</em></strong></li>
</ul>
<p>To answer these three questions, the first step is to <strong>build a functional space based on species traits</strong> on which functional diversity and functional rarity indices will be then computed.</p>
<p><br/></p>
<h1 id="part-1.-build-a-functional-space-using-the-mfd-package">Part 1. Build a functional space using the <code>mFD</code> package</h1>
<p><br/></p>
<h2 id="compute-summaries-about-your-data">1.0. Compute summaries about your data</h2>
<p><br/></p>
<p>This part is not developed in this Practice (not enough time to see everything ;) ), but it could be useful to know that the <code>mFD</code> package can compute summaries about your traits or assemblage data. For instance, you can compute a matrix of species occurrence in each assemblage (needed in 2.2).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Summary of the assemblages * species data.frame ----</span>
<span class='va'>asb_sp_fruits_summ</span> <span class='op'>&lt;-</span> <span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/asb.sp.summary.html'>asb.sp.summary</a></span><span class='op'>(</span>asb_sp_w <span class='op'>=</span> <span class='va'>baskets_fruits_weights</span><span class='op'>)</span>
<span class='va'>asb_sp_fruits_occ</span>  <span class='op'>&lt;-</span> <span class='va'>asb_sp_fruits_summ</span><span class='op'>$</span><span class='st'>"asb_sp_occ"</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>asb_sp_fruits_occ</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>         apple apricot banana currant blackberry blueberry cherry
basket_1     1       0      1       0          0         0      1
basket_2     1       0      1       0          0         0      1
basket_3     1       0      1       0          0         0      1
basket_4     1       0      0       0          0         0      0
basket_5     1       0      0       0          0         0      0
basket_6     1       0      1       0          0         0      0
         grape grapefruit kiwifruit lemon lime litchi mango melon
basket_1     0          0         0     1    0      0     0     1
basket_2     0          0         0     1    0      0     0     1
basket_3     0          0         0     1    0      0     0     1
basket_4     0          0         1     1    0      0     0     0
basket_5     0          0         1     1    0      0     0     0
basket_6     0          0         0     0    1      1     1     0
         orange passion_fruit peach pear pineapple plum raspberry
basket_1      0             1     0    1         0    0         0
basket_2      0             1     0    1         0    0         0
basket_3      0             1     0    1         0    0         0
basket_4      1             0     1    1         0    1         0
basket_5      1             0     1    1         0    1         0
basket_6      1             0     0    0         1    0         0
         strawberry tangerine water_melon
basket_1          1         0           0
basket_2          1         0           0
basket_3          1         0           0
basket_4          0         1           0
basket_5          0         1           0
basket_6          0         0           1</code></pre>
</div>
<p><br/></p>
<h2 id="what-about-the-traits">1.1. What about the traits?</h2>
<p><br/></p>
<p>The first thing to do before starting analyses is to know your data. To do so, you must be able to characterize the traits you are using (<em>i.e.</em> tell the package what type of traits you are using). That is why <code>mFD</code> package needs a <code>data.frame</code> summarizing the type of each trait (<em>i.e.</em> each column of the <code>fruits_traits</code> <code>data.frame</code>).</p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Loading data ----</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"fruits_traits_cat"</span>, package <span class='op'>=</span> <span class='st'>"mFD"</span><span class='op'>)</span>

<span class='co'>## Removing fuzzy traits in this tutorial ----</span>
<span class='va'>fruits_traits_cat</span> <span class='op'>&lt;-</span> <span class='va'>fruits_traits_cat</span><span class='op'>[</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span><span class='op'>:</span><span class='fl'>8</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'>## Thus remove the "fuzzy_name" column ----</span>
<span class='va'>fruits_traits_cat</span> <span class='op'>&lt;-</span> <span class='va'>fruits_traits_cat</span><span class='op'>[</span> , <span class='op'>-</span><span class='fl'>3</span><span class='op'>]</span>

<span class='co'>## Displaying the table ----</span>
<span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>fruits_traits_cat</span><span class='op'>)</span>, 
             caption <span class='op'>=</span> <span class='st'>"Traits types based on **fruits &amp; baskets** dataset"</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<caption><span id="tab:unnamed-chunk-5">Table 3: </span>Traits types based on <strong>fruits &amp; baskets</strong> dataset</caption>
<thead>
<tr class="header">
<th style="text-align: left;">trait_name</th>
<th style="text-align: left;">trait_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Size</td>
<td style="text-align: left;">O</td>
</tr>
<tr class="even">
<td style="text-align: left;">Plant</td>
<td style="text-align: left;">N</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Climate</td>
<td style="text-align: left;">O</td>
</tr>
<tr class="even">
<td style="text-align: left;">Seed</td>
<td style="text-align: left;">O</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sugar</td>
<td style="text-align: left;">Q</td>
</tr>
</tbody>
</table>
</div>
<p>The <strong>first column</strong> contains <strong>traits name</strong>. The <strong>second column</strong> contains <strong>traits type</strong> following this code:</p>
<ul>
<li><strong>N</strong>: nominal trait (factor variable)</li>
<li><strong>O</strong>: ordinal traits (ordered variable)</li>
<li><strong>C</strong>: circular traits (integer values) (<strong>N.B.</strong> circular traits can not be used in <code>mFD</code> function used to compute functional distance but ok for summary function and function to group species into Functional Entities)</li>
<li><strong>Q</strong>: quantitative traits (numeric values)</li>
<li><strong>F</strong>: fuzzy traits (described with several values defined in several columns in the <code>fruits_traits</code> <code>data.frame</code>)</li>
</ul>
<p><br/></p>
<h2 id="computing-distances-between-species-based-on-functional-traits">1.2. Computing distances between species based on functional traits</h2>
<p><br/></p>
<p>The next step toward the computation of functional diversity indices is to estimate functional traits-based distances between species in order to build the functional space in which indices will be computed.</p>
<p>To compute trait-based distances, we will use the <code>mFD::funct.dist()</code> function which includes the following arguments:</p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sp_dist_fruits</span> <span class='op'>&lt;-</span> <span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/funct.dist.html'>funct.dist</a></span><span class='op'>(</span>
  sp_tr         <span class='op'>=</span> <span class='va'>fruits_traits</span>,
  tr_cat        <span class='op'>=</span> <span class='va'>fruits_traits_cat</span>,
  metric        <span class='op'>=</span> <span class='st'>"gower"</span>,
  scale_euclid  <span class='op'>=</span> <span class='st'>"scale_center"</span>,
  ordinal_var   <span class='op'>=</span> <span class='st'>"classic"</span>,
  weight_type   <span class='op'>=</span> <span class='st'>"equal"</span>,
  stop_if_NA    <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li><p><code>sp_tr</code> is the species x trait <code>data.frame</code></p></li>
<li><p><code>tr_cat</code> is the <code>data.frame</code> summarizing trait type for each trait</p></li>
<li><p><code>metric</code> is a character string referring to the metric used to compute distances. Two metrics are available and <strong>the choice depends on your traits data</strong>:</p>
<ul>
<li><p>if <strong>all traits are continuous</strong> use the <strong>Euclidean distance</strong> (<code>metric = "euclidean"</code>) and check the <a href="https://cmlmagneville.github.io/mFD/articles/Continuous_traits_framework.html">Compute Functional Diversity Indices based on Only Continuous Traits</a> tutorial which explains how to build a multidimensional space from traits through PCA analysis or considering directly each trait as a dimension.</p></li>
<li><p>if you have <strong>non-continuous traits</strong> use the <strong>Gower distance</strong> (<code>metric = "gower"</code>) as this method allows traits weighting. This method can also deal with fuzzy traits.</p></li>
</ul></li>
<li><p><code>scale_euclid</code> is a character string referring to the way the user wants to scale <strong>euclidean</strong> traits. You can either chose to scale by range (<code>range</code>), use the center transformation (<code>center</code>), use the scale transformation (<code>scale</code>), use the scale-center transformation (<code>scale_center</code>) or you can chose not to scale (<code>noscale</code>).</p></li>
<li><p><code>ordinal_var</code> is a character string specifying the method to be used for ordinal variables (<em>i.e.</em> ordered). You can either chose to treat ordinal variables as continuous variables (with <code>"classic"</code> option) or to treat ordinal variables as ranks (with <code>metric</code> or <code>podani</code> options, see <code>mFD::funct.dist()</code> help file for detail).</p></li>
<li><p><code>weight_type</code> is a character string referring to the type of method to weight traits. You can either chose to define weights using the <code>tr_cat</code> <code>data.frame</code> (cf. <strong>step 1.1</strong>) (<code>user</code> option) or you can chose to give the same weight to all traits (<code>equal</code> option). (<strong>N.B.</strong> Using <code>mFD</code>, you can not define weights for fuzzy traits, use <a href="https://cran.r-project.org/package=gawdis"><code>gawdis</code></a> package instead)</p></li>
<li><p><code>stop_if_NA</code> is a logical value to stop or not the process if the <code>sp_tr</code> <code>data.frame</code> contains <code>NA</code>. If the <code>sp_tr</code> <code>data.frame</code> contains <code>NA</code> you can either chose to compute anyway functional distances (but keep in mind that <strong>Functional measures are sensitive to missing traits!</strong>) or you can delete species with missing or extrapolate missing traits (see <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/geb.13185">Johnson <em>et al.</em> (2020)</a>).</p></li>
</ul>
<p>This function returns a <code>dist</code> object with traits-based distances between all pairs of species:</p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Output of the function mFD::funct.dist() ----</span>
<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>sp_dist_fruits</span>, <span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>              apple apricot banana currant blackberry blueberry
apricot       0.166                                            
banana        0.375   0.541                                    
currant       0.391   0.426  0.767                             
blackberry    0.376   0.410  0.751   0.084                     
blueberry     0.355   0.410  0.731   0.236      0.320          
cherry        0.233   0.099  0.558   0.425      0.409     0.389
grape         0.380   0.446  0.705   0.372      0.356     0.336
grapefruit    0.192   0.327  0.268   0.501      0.483     0.537
kiwifruit     0.219   0.353  0.595   0.372      0.356     0.364
lemon         0.208   0.343  0.384   0.517      0.433     0.553
lime          0.370   0.404  0.345   0.578      0.494     0.614
litchi        0.466   0.332  0.391   0.658      0.642     0.622
mango         0.395   0.361  0.220   0.786      0.771     0.750
melon         0.285   0.419  0.560   0.407      0.391     0.229
orange        0.117   0.251  0.292   0.474      0.459     0.462
passion_fruit 0.461   0.527  0.414   0.553      0.537     0.516
peach         0.127   0.062  0.503   0.464      0.448     0.472
pear          0.009   0.157  0.384   0.383      0.367     0.353
pineapple     0.557   0.708  0.233   0.734      0.718     0.502
plum          0.156   0.009  0.532   0.435      0.419     0.401
raspberry     0.382   0.416  0.758   0.091      0.007     0.327
strawberry    0.376   0.410  0.751   0.284      0.200     0.120
tangerine     0.153   0.218  0.323   0.444      0.428     0.408
water_melon   0.281   0.415  0.556   0.410      0.395     0.226
              cherry grape grapefruit kiwifruit lemon  lime litchi
apricot                                                           
banana                                                            
currant                                                           
blackberry                                                        
blueberry                                                         
cherry                                                            
grape          0.347                                              
grapefruit     0.426 0.573                                        
kiwifruit      0.453 0.200      0.373                             
lemon          0.442 0.589      0.116     0.389                   
lime           0.503 0.650      0.277     0.550 0.161             
litchi         0.233 0.514      0.459     0.686 0.475 0.336       
mango          0.362 0.686      0.287     0.614 0.403 0.364  0.172
melon          0.518 0.465      0.308     0.266 0.424 0.585  0.751
orange         0.351 0.498      0.075     0.302 0.091 0.252  0.384
passion_fruit  0.572 0.319      0.453     0.280 0.470 0.331  0.405
peach          0.161 0.508      0.265     0.308 0.281 0.442  0.394
pear           0.242 0.389      0.184     0.210 0.200 0.361  0.475
pineapple      0.791 0.738      0.435     0.562 0.551 0.512  0.624
plum           0.090 0.437      0.336     0.363 0.352 0.413  0.323
raspberry      0.416 0.363      0.490     0.363 0.426 0.487  0.649
strawberry     0.409 0.356      0.483     0.356 0.433 0.494  0.642
tangerine      0.281 0.428      0.145     0.372 0.161 0.222  0.314
water_melon    0.515 0.462      0.311     0.262 0.427 0.588  0.748
              mango melon orange passion_fruit peach  pear pineapple
apricot                                                             
banana                                                              
currant                                                             
blackberry                                                          
blueberry                                                           
cherry                                                              
grape                                                               
grapefruit                                                          
kiwifruit                                                           
lemon                                                               
lime                                                                
litchi                                                              
mango                                                               
melon         0.580                                                 
orange        0.312 0.368                                           
passion_fruit 0.434 0.546  0.378                                    
peach         0.322 0.357  0.210         0.589                      
pear          0.404 0.276  0.108         0.470 0.119                
pineapple     0.452 0.327  0.460         0.419 0.670 0.551          
plum          0.351 0.428  0.261         0.518 0.071 0.152     0.701
raspberry     0.777 0.398  0.465         0.543 0.455 0.373     0.725
strawberry    0.770 0.191  0.458         0.537 0.448 0.367     0.518
tangerine     0.342 0.437  0.070         0.309 0.280 0.161     0.510
water_melon   0.576 0.004  0.364         0.542 0.354 0.272     0.324
               plum raspberry strawberry tangerine
apricot                                           
banana                                            
currant                                           
blackberry                                        
blueberry                                         
cherry                                            
grape                                             
grapefruit                                        
kiwifruit                                         
lemon                                             
lime                                              
litchi                                            
mango                                             
melon                                             
orange                                            
passion_fruit                                     
peach                                             
pear                                              
pineapple                                         
plum                                              
raspberry     0.426                               
strawberry    0.419     0.207                     
tangerine     0.209     0.435      0.428          
water_melon   0.425     0.401      0.194     0.434</code></pre>
</div>
<p><br/></p>
<h2 id="building-functional-spaces-and-chosing-the-best-one">1.3. Building functional spaces and chosing the best one</h2>
<p><br/></p>
<h3 id="computing-several-multimensional-functional-spaces-and-assessing-their-quality">1.3.1. Computing several multimensional functional spaces and assessing their quality</h3>
<p><br/></p>
<p>In order to generate a multidimensional space in which functional diversity indices are computed (<a href="https://www.sciencedirect.com/science/article/pii/S0169534712002650">Mouillot <em>et al.</em> 2013</a>, we will perform a PCoA using the trait-based distances (and if required a functional dendrogram). <code>mFD</code> evaluates the quality of PCoA-based multidimensional spaces according to the deviation between trait-based distances and distances in the functional space (extension of <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/geb.12299">Maire <em>et al.</em> (2015)</a> framework). For that, we will use the <code>mFD::quality.fspaces()</code> function:</p>
<p><br /></p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fspaces_quality_fruits</span> <span class='op'>&lt;-</span> <span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/quality.fspaces.html'>quality.fspaces</a></span><span class='op'>(</span>
  sp_dist             <span class='op'>=</span> <span class='va'>sp_dist_fruits</span>,
  maxdim_pcoa         <span class='op'>=</span> <span class='fl'>10</span>,
  deviation_weighting <span class='op'>=</span> <span class='st'>"absolute"</span>,
  fdist_scaling       <span class='op'>=</span> <span class='cn'>FALSE</span>,
  fdendro             <span class='op'>=</span> <span class='st'>"average"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li><p><code>sp_dist</code> is the <code>dist</code> object with pairwise trait-based distance between species as computed in <strong>step 1.2</strong></p></li>
<li><p><code>maxdim_pcoa</code> is the maximum number of PCoA axes to consider to build multidimensional spaces. Actually, the maximum number of dimensions considered depends on the number of PCoA axes with positive eigenvalues.</p></li>
<li><p><code>deviation_weighting</code> refers to the method(s) used to weight the difference between species pairwise distances in the functional space and trait-based distances. <strong>You can chose between</strong>:</p>
<ul>
<li><code>absolute</code>: absolute differences are used to compute the <strong>mean absolute deviation (mad)</strong> . It reflects the actual magnitude of errors that will affect FD metrics.</li>
<li><code>squared</code>: squared differences are used to compute the <strong>root of mean square deviation (rmsd)</strong>. This weighting puts more weight to the large deviations between trait-based distances and distances in the functional space.</li>
<li>Both quality metrics can be used with: <code>deviation_weighting = c("absolute", "squared")</code>.</li>
</ul></li>
<li><p><code>fdist_scaling</code> specifies whether distances in the functional space should be scaled before computing differences with trait-based distances. Scaling ensures that trait-based distances and distances in the functional space have the same maximum. Scaling distances implies that the quality of the functional space accounts for congruence in distances rather than their equality.</p></li>
</ul>
<p><strong>N.B.</strong> The combination of <code>deviation_weighting</code> and <code>fdist_scaling</code> arguments leads to <strong>four possible quality metrics</strong>: <code>mad</code>, <code>rmsd</code>, <code>mad_scaled</code> and <code>rmsd_scaled</code></p>
<ul>
<li><code>fdendro</code> specifies the clustering algorithm to compute a functional dendrogram. <code>NULL</code> means no dendrogram computed. The chosen algorithm must be one of the method recognized by the <code>stats::hclust()</code> function from the <a href="https://www.rdocumentation.org/packages/stats"><code>stats</code></a> package.</li>
</ul>
<p>This function returns a list various objects:</p>
<p><br /></p>
<ul>
<li>a <code>data.frame</code> gathering for each space (in rows), values of quality metric(s) (in columns)</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Quality metrics of functional spaces ----</span>
<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>fspaces_quality_fruits</span><span class='op'>$</span><span class='st'>"quality_fspaces"</span>, <span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>               mad
pcoa_1d      0.150
pcoa_2d      0.073
pcoa_3d      0.047
pcoa_4d      0.040
pcoa_5d      0.049
pcoa_6d      0.055
pcoa_7d      0.060
pcoa_8d      0.064
pcoa_9d      0.065
pcoa_10d     0.065
tree_average 0.082</code></pre>
</div>
<p><br /></p>
<ul>
<li><code>list</code> with details required for other tasks in <strong>step 1.4</strong> to plot functional space quality and in <strong>step 1.5</strong> to plot functional space.</li>
</ul>
<p><br /></p>
<p><strong>N.B.</strong> The space with the best quality has the lowest quality metric. Here, thanks to mad values, we can see that the 4D space is the best one. That is why the following of this Practice will use this multidimensional space.</p>
<p><br/></p>
<h3 id="illustrating-the-quality-of-the-functional-spaces">1.3.2. Illustrating the quality of the functional spaces</h3>
<p><br/></p>
<p>With the <code>mFD</code> package, it is possible to illustrate the quality of PCoA-based multidimensional spaces according to deviation between trait-based distances and distances in the functional space. For that, we use the <code>mFD::quality.fspace.plot()</code> function with the following arguments:</p>
<p><br /></p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/quality.fspaces.plot.html'>quality.fspaces.plot</a></span><span class='op'>(</span>
  fspaces_quality            <span class='op'>=</span> <span class='va'>fspaces_quality_fruits</span>,
  quality_metric             <span class='op'>=</span> <span class='st'>"mad"</span>,
  fspaces_plot               <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"tree_average"</span>, <span class='st'>"pcoa_2d"</span>, <span class='st'>"pcoa_3d"</span>, 
                                 <span class='st'>"pcoa_4d"</span>, <span class='st'>"pcoa_5d"</span>, <span class='st'>"pcoa_6d"</span><span class='op'>)</span>,
  name_file                  <span class='op'>=</span> <span class='cn'>NULL</span>,
  range_dist                 <span class='op'>=</span> <span class='cn'>NULL</span>,
  range_dev                  <span class='op'>=</span> <span class='cn'>NULL</span>,
  range_qdev                 <span class='op'>=</span> <span class='cn'>NULL</span>,
  gradient_deviation         <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>neg <span class='op'>=</span> <span class='st'>"darkblue"</span>, nul <span class='op'>=</span> <span class='st'>"grey80"</span>, pos <span class='op'>=</span> <span class='st'>"darkred"</span><span class='op'>)</span>,
  gradient_deviation_quality <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"yellow"</span>, high <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span>,
  x_lab                      <span class='op'>=</span> <span class='st'>"Trait-based distance"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li><p><code>fspaces_quality</code> is the output of the <code>mFD::quality.fspaces()</code> function (<strong>step 1.3.1</strong>).</p></li>
<li><p><code>quality_metric</code> refers to the quality metric used. It should be one of the column name(s) of the table gathering quality metric values (output of <code>mFD::quality.fspaces()</code> called <code>quality_fspaces</code>) (here: <code>fspaces_quality_fruits$quality_fspaces</code>) Thus it can be: <code>mad</code>, <code>rmsd</code>, <code>mad_scaled</code> or <code>rmsd_scaled</code> (see <strong>step 1.3.1</strong>)</p></li>
<li><p><code>fspaces_plot</code> refers to the names of spaces for which quality has to be illustrated (up to 10). Names are those used in the output of <code>mFD::quality.fspaces()</code> function showing the values of the quality metric.</p></li>
<li><p><code>name_file</code> refers to the name of file to save (without extension) if the user wants to save the figure. If the user only wants the plot to be displayed, then <code>name_file = NULL</code>.</p></li>
<li><p><code>range_dist</code>, <code>range_dev</code>, <code>range_qdev</code> are arguments to set ranges of panel axes (check function help for further information).</p></li>
<li><p><code>gradient_deviation</code> and <code>gradient_deviation_quality</code> are arguments to set points colors (check function help for further information).</p></li>
<li><p><code>xlab</code> is a parameter to set x-axis label.</p></li>
</ul>
<p><br /></p>
<p>This function generates a figure with three panels (in rows) for each selected functional space (in columns). Each column represents a functional space, the value of the quality metric is written on the top of each column. The x-axis of all panels represents trait-based distances. The y-axis is different for each row:</p>
<ul>
<li>on the first (top) row, the y-axis represents species functional distances in the multidimensional space. Thus, the closer species are to the 1:1 line, the better distances in the functional space fit trait-based ones.</li>
<li>on the second row, the y-axis shows the raw deviation of species distances in the functional space compared to trait-based distances. Thus, the raw deviation reflects the distance to the 1:1 line.</li>
<li>on the third row (bottom), the y-axis shows the absolute or squared deviation of the (“scaled”) distance in the functional space. It is the deviation that is taken into account for computing the quality metric.</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/quality.fspaces.plot.html'>quality.fspaces.plot</a></span><span class='op'>(</span>
  fspaces_quality            <span class='op'>=</span> <span class='va'>fspaces_quality_fruits</span>,
  quality_metric             <span class='op'>=</span> <span class='st'>"mad"</span>,
  fspaces_plot               <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"tree_average"</span>, <span class='st'>"pcoa_2d"</span>, <span class='st'>"pcoa_3d"</span>,
                                 <span class='st'>"pcoa_4d"</span>, <span class='st'>"pcoa_5d"</span>, <span class='st'>"pcoa_6d"</span><span class='op'>)</span>,
  name_file                  <span class='op'>=</span> <span class='cn'>NULL</span>,
  range_dist                 <span class='op'>=</span> <span class='cn'>NULL</span>,
  range_dev                  <span class='op'>=</span> <span class='cn'>NULL</span>,
  range_qdev                 <span class='op'>=</span> <span class='cn'>NULL</span>,
  gradient_deviation         <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>neg <span class='op'>=</span> <span class='st'>"darkblue"</span>, nul <span class='op'>=</span> <span class='st'>"grey80"</span>, pos <span class='op'>=</span> <span class='st'>"darkred"</span><span class='op'>)</span>,
  gradient_deviation_quality <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"yellow"</span>, high <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span>,
  x_lab                      <span class='op'>=</span> <span class='st'>"Trait-based distance"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/unnamed-chunk-11-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<p><br /></p>
<p>For the 2D space, on the top row there are a lot of points below the 1:1 lines, meaning that distances are overestimated in this multidimensional space. Looking at panels, we can see that the 4D space is the one in which points are the closest to the 1:1 line on the top row,and the closest to the x-axis for the two bottom rows, which reflects a better quality compared to other functional spaces / dendrogram. For the dendrogram, we can see on the top row that species pairs arrange in horizontal lines, meaning that different trait-based distances have then the same cophenetic distance on the dendrogram.</p>
<p><br/></p>
<h3 id="testing-the-correlation-between-functional-axes-and-traits">1.3.3. Testing the correlation between functional axes and traits</h3>
<p><br /></p>
<p><code>mFD</code> allows to test for correlations between traits and functional axes and then illustrate possible correlations (continuous traits = linear model is computed and r<sup>2</sup> and associated p-value are returned; non-continuous traits = Kruskal-Wallis test is computed and eta2 statistic is returned). The function <code>mFD::traits.faxes.cor()</code> allows to test and plot correlation and needs the following arguments:</p>
<ul>
<li><code>sp_tr</code> is the species x traits <code>data.frame</code></li>
<li><code>sp_faxes_coord</code> is a <code>matrix</code> of species coordinates taken from the outputs of the <code>mFD::quality.fspaces()</code> function <strong>with columns representing axes on which functional space must be computed</strong>. For instance, in this tutorial, we will plot the functional space for 4 and 10 dimensions (<em>cf.</em> the two examples below). The whole <code>sp_faxes_coord</code> can be retrieved through the output of the <code>mFD::quality.fspaces()</code> function:</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sp_faxes_coord_fruits</span> <span class='op'>&lt;-</span> <span class='va'>fspaces_quality_fruits</span><span class='op'>$</span><span class='st'>"details_fspaces"</span><span class='op'>$</span><span class='st'>"sp_pc_coord"</span>
</code></pre>
</div>
</div>
<ul>
<li><code>plot</code> is a logical value indicating whether correlations should be illustrated or not. If this option is set to <code>TRUE</code>, traits-axis relationships are plotted through scatterplot for continuous traits and boxplot for non-continuous traits.</li>
</ul>
<p>The function <code>mFD::traits.faxes.cor()</code> works as follows:</p>
<p><br /></p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fruits_tr_faxes</span> <span class='op'>&lt;-</span> <span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/traits.faxes.cor.html'>traits.faxes.cor</a></span><span class='op'>(</span>
  sp_tr          <span class='op'>=</span> <span class='va'>fruits_traits</span>, 
  sp_faxes_coord <span class='op'>=</span> <span class='va'>sp_faxes_coord_fruits</span><span class='op'>[</span> , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"PC1"</span>, <span class='st'>"PC2"</span>, <span class='st'>"PC3"</span>, <span class='st'>"PC4"</span><span class='op'>)</span><span class='op'>]</span>, 
  plot           <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We can print only traits with significant effect on position along one of the axis and look at the plots:</p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Print traits with significant effect ----</span>
<span class='va'>fruits_tr_faxes</span><span class='op'>$</span><span class='st'>"tr_faxes_stat"</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>fruits_tr_faxes</span><span class='op'>$</span><span class='st'>"tr_faxes_stat"</span><span class='op'>$</span><span class='st'>"p.value"</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span><span class='op'>)</span>, <span class='op'>]</span>
</code></pre>
</div>
<pre><code>     trait axis           test stat value p.value
1     Size  PC1 Kruskal-Wallis eta2 0.308  0.0377
3     Size  PC3 Kruskal-Wallis eta2 0.326  0.0325
5    Plant  PC1 Kruskal-Wallis eta2 0.471  0.0049
6    Plant  PC2 Kruskal-Wallis eta2 0.382  0.0116
8    Plant  PC4 Kruskal-Wallis eta2 0.264  0.0360
9  Climate  PC1 Kruskal-Wallis eta2 0.731  0.0001
13    Seed  PC1 Kruskal-Wallis eta2 0.201  0.0402
14    Seed  PC2 Kruskal-Wallis eta2 0.593  0.0005
20   Sugar  PC4   Linear Model   r2 0.682  0.0000</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Plot ----</span>
<span class='va'>fruits_tr_faxes</span><span class='op'>$</span><span class='st'>"tr_faxes_plot"</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/unnamed-chunk-14-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<p><br /></p>
<p>We can thus see that <strong>PC1</strong> is mostly driven by <em>Climate</em> (temperate on the left and tropical on the right) and <em>Plant Type</em> (forb &amp; shrub on the left vs tree &amp; vine on the right) and <em>Size</em> (large fruits on the right) with weaker influence of <em>Seed</em> (eta2 &lt; 0.25). Then, <strong>PC2</strong> is mostly driven by <em>Seed</em> (no seed on the left and pit seed on the right) with weaker influence of <em>Plant Type</em>. <strong>PC3</strong> is driven by only one trait, <em>Size</em>. And finally <strong>PC4</strong> is mostly driven by <em>Sugar</em> (high sugar content on the right and low sugar content on the left) with a weaker influence of <em>Plant Type</em>.</p>
<p><br /></p>
<h2 id="plotting-the-selected-functional-space-and-position-of-species">1.4. Plotting the selected functional space and position of species</h2>
<p><br/></p>
<p>Once the user has selected the dimensionality of the functional space, <code>mFD</code> allows you to plot the given multidimensional functional space and the position of species in all 2-dimensions spaces made by pairs of axes.</p>
<p><br /></p>
<p>The <code>mFD::funct.space.plot()</code> function allows to illustrate the position of all species along pairs of space axes.</p>
<p><br /></p>
<p>This function allows to plot with many possibilities to change colors/shapes of each plotted element. Here are listed the main arguments:</p>
<ul>
<li><code>sp_faxes_coord</code> is a <code>matrix</code> of species coordinates taken from the outputs of the <code>mFD::quality.fspaces()</code> function <strong>with columns representing axes on which functional space must be computed</strong>. For instance, in this tutorial, we will plot the functional space for 4 and 10 dimensions (<em>cf.</em> the two examples below). The whole <code>sp_faxes_coord</code> can be retrieved through the output of the <code>mFD::quality.fspaces()</code> function:</li>
</ul>
<p><br /></p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sp_faxes_coord_fruits</span> <span class='op'>&lt;-</span> <span class='va'>fspaces_quality_fruits</span><span class='op'>$</span><span class='st'>"details_fspaces"</span><span class='op'>$</span><span class='st'>"sp_pc_coord"</span>
</code></pre>
</div>
</div>
<p><br /></p>
<ul>
<li><p><code>faxes</code> is a <code>vector</code> containing names of axes to plot. If set to <code>NULL</code>, the first four functional axes will be plotted.</p></li>
<li><p><code>faxes_nm</code> is a <code>vector</code> containing labels of <code>faxes</code> (following faxes vector rank). If <code>NULL</code>, labels follow <code>faxes</code> vector names.</p></li>
<li><p><code>range_faxes</code> is a <code>vector</code> to complete if the user wants to set specific limits for functional axes. If <code>range_faxes = c(NA, NA)</code>, the range is computed according to the range of values among all axes.</p></li>
<li><p><code>plot_ch</code> is a <code>logical</code> value used to draw or not the 2D convex-hull filled by the global pool of species. Color, fill and opacity of the convex hull can be chosen through other inputs, please refer to the function’s help.</p></li>
<li><p><code>plot_sp_nm</code> is a <code>vector</code> containing species names to plot. If <code>NULL</code>, no species names plotted. Name size, color and font can be chosen through other inputs, please refer to the function’s help.</p></li>
<li><p><code>plot_vertices</code> is a <code>logical</code> value used to plot or not vertices with a different shape than other species. <strong>Be careful</strong> these representations are 2D representations, thus vertices of the convex-hull in the n-multidimensional space can be close to the center of the hull projected in 2D. Color, fill, shape and size of vertices can be chosen through other inputs, please refer to the function’s help.</p></li>
<li><p><code>check_input</code> is a recurrent argument in the <code>mFD</code> package. It defines whether inputs should be checked before computation or not. Possible error messages will thus be more understandable for the user than R error messages (<strong>Recommendation:</strong> set it as <code>TRUE</code>).</p></li>
<li><p>other inputs are used to chose color, fill, size, and shape of species from the global pool, please refer to the function’s help.</p></li>
</ul>
<p><br /></p>
<p>Here are the plots for the <em>fruits &amp; baskets</em> dataset for the <strong>first four PCoA axis</strong>:</p>
<p><br /></p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>big_plot</span> <span class='op'>&lt;-</span> <span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/funct.space.plot.html'>funct.space.plot</a></span><span class='op'>(</span>
  sp_faxes_coord  <span class='op'>=</span> <span class='va'>sp_faxes_coord_fruits</span><span class='op'>[</span> , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"PC1"</span>, <span class='st'>"PC2"</span>, <span class='st'>"PC3"</span>, <span class='st'>"PC4"</span><span class='op'>)</span><span class='op'>]</span>,
  faxes           <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"PC1"</span>, <span class='st'>"PC2"</span>, <span class='st'>"PC3"</span>, <span class='st'>"PC4"</span><span class='op'>)</span>,
  name_file       <span class='op'>=</span> <span class='cn'>NULL</span>,
  faxes_nm        <span class='op'>=</span> <span class='cn'>NULL</span>,
  range_faxes     <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='cn'>NA</span><span class='op'>)</span>,
  plot_ch         <span class='op'>=</span> <span class='cn'>TRUE</span>,
  plot_vertices   <span class='op'>=</span> <span class='cn'>TRUE</span>,
  plot_sp_nm      <span class='op'>=</span> <span class='cn'>NULL</span>,
  check_input     <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='va'>big_plot</span><span class='op'>$</span><span class='st'>"patchwork"</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/unnamed-chunk-16-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<p><br /></p>
<p>Here, the convex-hull of the species pool is plotted in white and axis have the same range to get rid of bias based on different axis scales. Species being vertices of the 4D convex hull are in purple.</p>
<p><br/></p>
<h1 id="part-2.-computing-and-plotting-fd-indices-using-the-mfd-package">Part 2. Computing and plotting FD indices using the <code>mFD</code> package</h1>
<p><br /></p>
<p>The <code>mFD::alpha.fd.multidim()</code> function allows computing alpha and beta FD indices.</p>
<p><br /></p>
<h2 id="computing-and-plotting-alpha-fd-indices">2.1. Computing and plotting alpha FD indices</h2>
<p><br /></p>
<p>Using the <code>alpha.fd.multidim()</code> function, you can compute up to nine alpha FD indices:</p>
<ul>
<li><p><code>FDis</code> <strong>Functional Dispersion</strong>: the biomass weighted deviation of species traits values from the center of the functional space filled by the assemblage <em>i.e.</em> the biomass-weighted mean distance to the biomass-weighted mean trait values of the assemblage.</p></li>
<li><p><code>FRic</code> <strong>Functional Richness</strong>: the proportion of functional space filled by species of the studied assemblage, <em>i.e.</em> the volume inside the convex-hull shaping species. To compute <code>FRic</code> the number of species must be at least higher than the number of functional axis + 1.</p></li>
<li><p><code>FDiv</code> <strong>Functional Divergence</strong>: the proportion of the biomass supported by the species with the most extreme functional traits <em>i.e.</em> the ones located close to the edge of the convex-hull filled by the assemblage.</p></li>
<li><p><code>FEve</code> <strong>Functional Evenness</strong>: the regularity of biomass distribution in the functional space using the Minimum Spanning Tree linking all species present in the assemblage.</p></li>
<li><p><code>FSpe</code> <strong>Functional Specialization</strong>: the biomass weighted mean distance to the mean position of species from the global pool (present in all assemblages).</p></li>
<li><p><code>FMPD</code> <strong>Functional Mean Pairwise Distance</strong>: the mean weighted distance between all species pairs.</p></li>
<li><p><code>FNND</code> <strong>Functional Mean Nearest Neighbour Distance</strong>: the weighted distance to the nearest neighbor within the assemblage.</p></li>
<li><p><code>FIde</code> <strong>Functional Identity</strong>: the mean traits values for the assemblage. <code>FIde</code> is always computed when <code>FDis</code> is computed.</p></li>
<li><p><code>FOri</code> <strong>Functional Originality</strong>: the weighted mean distance to the nearest species from the global species pool.</p></li>
</ul>
<p>In this Practice we will only compute five of them. The function is used as follow:</p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>alpha_fd_indices_fruits</span> <span class='op'>&lt;-</span> <span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/alpha.fd.multidim.html'>alpha.fd.multidim</a></span><span class='op'>(</span>
  sp_faxes_coord   <span class='op'>=</span> <span class='va'>sp_faxes_coord_fruits</span><span class='op'>[</span> , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"PC1"</span>, <span class='st'>"PC2"</span>, <span class='st'>"PC3"</span>, <span class='st'>"PC4"</span><span class='op'>)</span><span class='op'>]</span>,
  asb_sp_w         <span class='op'>=</span> <span class='va'>baskets_fruits_weights</span>,
  ind_vect         <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"fdis"</span>, <span class='st'>"fric"</span>, <span class='st'>"fdiv"</span>, 
                       <span class='st'>"fspe"</span>, <span class='st'>"fide"</span><span class='op'>)</span>,
  scaling          <span class='op'>=</span> <span class='cn'>TRUE</span>,
  check_input      <span class='op'>=</span> <span class='cn'>TRUE</span>,
  details_returned <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p><br /></p>
<p>The arguments and their use are listed below:</p>
<ul>
<li><p><code>sp_faxes_coord</code> is the species coordinates matrix. This dataframe gathers only axis of the functional space you have chosen based on <strong>step 4</strong>.</p></li>
<li><p><code>asb_sp_w</code> is the matrix linking species and assemblages they belong to (summarized in <strong>step 1</strong>).</p></li>
<li><p><code>ind_vect</code> is a vector with names of diversity functional indices to compute.</p></li>
<li><p><code>scaling</code> is a logical value indicating whether indices should be scaled between 0 and 1. If scaling is to be done, this argument must be set to <code>TRUE</code>.</p></li>
<li><p><code>check_input</code> is a recurrent argument in the <code>mFD</code> package. It defines whether inputs should be checked before computation or not. Possible error messages will thus be more understandable for the user than R error messages (<strong>Recommendation:</strong> set it as <code>TRUE</code>).</p></li>
<li><p><code>details_returned</code> is used if the user wants to store information that are used in graphical functions. If the user wants to plot FD indices, then <code>details_returned</code> must be set to <code>TRUE</code>.</p></li>
</ul>
<p><br /></p>
<p><strong>N.B.</strong> <strong>Use lowercase letters to enter FD indices names</strong></p>
<p><br /></p>
<p>The function has two main outputs:</p>
<ul>
<li>a <strong><code>data.frame</code> gathering indices values in each assemblage</strong> (for <code>FIde</code> values, there are as many columns as there are axes to the studied functional space).</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fd_ind_values_fruits</span> <span class='op'>&lt;-</span> <span class='va'>alpha_fd_indices_fruits</span><span class='op'>$</span><span class='st'>"functional_diversity_indices"</span>
<span class='va'>fd_ind_values_fruits</span>
</code></pre>
</div>
<pre><code>          sp_richn      fdis        fric      fdiv      fspe
basket_1         8 0.4763773 0.162830681 0.5514453 0.4127138
basket_2         8 0.7207823 0.162830681 0.8064809 0.5781232
basket_3         8 0.7416008 0.162830681 0.8089535 0.5888104
basket_4         8 0.2958614 0.007880372 0.6080409 0.3106937
basket_5         8 0.3673992 0.007880372 0.7288912 0.3488358
basket_6         8 0.8001980 0.147936148 0.8937934 0.7930809
basket_7         8 0.8121314 0.147936148 0.8989094 0.7443406
basket_8         8 0.4678159 0.036480112 0.7113688 0.6363814
basket_9         8 0.5577452 0.036480112 0.7787237 0.6309078
basket_10        8 0.5505783 0.025774304 0.7741681 0.4587432
             fide_PC1     fide_PC2    fide_PC3     fide_PC4
basket_1  -0.01473662 -0.009461738 -0.05670043 -0.001823969
basket_2   0.01887361 -0.061601373 -0.04427402  0.021249327
basket_3   0.04724418 -0.056571400 -0.03631846  0.018045257
basket_4   0.03994897  0.052581211 -0.08413271 -0.001343112
basket_5   0.02349573  0.039069220 -0.08187248 -0.010262902
basket_6   0.24320913 -0.114434642  0.01394977  0.025500282
basket_7   0.13341179 -0.183609095 -0.01782549  0.021494300
basket_8  -0.24497368  0.036194656  0.04748935 -0.038827673
basket_9  -0.21021559  0.029339706  0.05516746 -0.041392184
basket_10 -0.05375867 -0.005743348 -0.05649324  0.041191011</code></pre>
</div>
<p><br /></p>
<ul>
<li>a <strong>details list</strong> of <code>data.frames</code> and <code>lists</code> gathering information such as coordinates of centroids, distances and identity of the nearest neighbour, distances to the centroid, etc. The user does not have to directly use it but it will be useful if FD indices are then plotted. It can be retrieved through:</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>details_list_fruits</span> <span class='op'>&lt;-</span> <span class='va'>alpha_fd_indices_fruits</span><span class='op'>$</span><span class='st'>"details"</span>
</code></pre>
</div>
</div>
<p><br /></p>
<p>Then, you can plot functional indices using the <code>mFD::alpha.multidim.plot()</code> for up to two assemblages:</p>
<p><br /></p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>plots_alpha</span> <span class='op'>&lt;-</span> <span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/alpha.multidim.plot.html'>alpha.multidim.plot</a></span><span class='op'>(</span>
  output_alpha_fd_multidim <span class='op'>=</span> <span class='va'>alpha_fd_indices_fruits</span>,
  plot_asb_nm              <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"basket_1"</span>, <span class='st'>"basket_5"</span><span class='op'>)</span>,
  ind_nm                   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"fdis"</span>, <span class='st'>"fric"</span>, <span class='st'>"fdiv"</span>, 
                              <span class='st'>"fspe"</span>, <span class='st'>"fide"</span><span class='op'>)</span>,
  faxes                    <span class='op'>=</span> <span class='cn'>NULL</span>,
  faxes_nm                 <span class='op'>=</span> <span class='cn'>NULL</span>,
  range_faxes              <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='cn'>NA</span><span class='op'>)</span>,
  plot_sp_nm               <span class='op'>=</span> <span class='cn'>NULL</span>,
  save_file                <span class='op'>=</span> <span class='cn'>FALSE</span>,
  check_input              <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<p><br /></p>
<p>This function has a lot of arguments: most of them are graphical arguments allowing the user to chose colors, shapes, sizes, scales, etc. This tutorial only presents main arguments. To learn about the use of graphical arguments, check the function help file. The main arguments of this function are listed below:</p>
<ul>
<li><code>output_alpha_fd_multidim</code> is the output of the `<code>mFD::alpha.fd.multidim()</code> function.</li>
<li><code>plot_asb_nm</code> is a vector gathering name(s) of assemblage(s) to plot.</li>
<li><code>ind_vect</code> is a vector gathering FD indices to plot. Plots are available for <code>FDis</code>, <code>FIde</code>, <code>FEve</code>, <code>FRic</code>, <code>FDiv</code>, <code>FOri</code>, <code>FSpe</code>, and <code>FNND.</code></li>
<li><code>faxes</code> is a vector containing names of axes to plot. You can only plot from two to four axes labels for graphical reasons.</li>
<li><code>faxes_nm</code> is a vector with axes labels if the user ants different axes labels than <code>faxes</code> ones.</li>
<li><code>range_faxes</code> is a vector with minimum and maximum values for axes. If <code>range_faxes = c(NA, NA)</code>, the range is computed according to the range of values among all axes, all axes having thus the same range. To have a fair representation of species positions in all plots, all axes must have the same range.</li>
<li><code>plot_sp_nm</code> is a vector containing species names to plot. If <code>NULL</code>, then no name is plotted.</li>
<li><code>check_input</code> is a recurrent argument in <code>mFD</code>. It defines whether inputs should be checked before computation or not. Possible error messages will thus be more understandable for the user than R error messages (<strong>Recommendation:</strong> set it as <code>TRUE</code>.</li>
<li>size, color, fill, and shape arguments for each component of the graphs <em>i.e.</em> species of the global pool, species of the studied assemblage(s), vertices, centroids and segments. If you have to plot two assemblages, then inputs should be formatted as follow: <code>c(pool = ..., asb1 = ..., asb2 = ...)</code> for inputs used for global pool and studied assemblages and <code>c(asb1 = ..., asb2 = ...)</code> for inputs used for studied assemblages only.</li>
</ul>
<p><br /></p>
<p>Then, using these arguments, here are the output plots for the <strong>fruits &amp; baskets</strong> dataset:</p>
<p><br /></p>
<ul>
<li><code>FRic</code> representation: the colored shapes reflect the convex-hull of the studied assemblages and the white shape reflects the convex-hull of the global pool of species:</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>plots_alpha</span><span class='op'>$</span><span class='st'>"fric"</span><span class='op'>$</span><span class='st'>"patchwork"</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/unnamed-chunk-21-1.png" width="1920" style="display: block; margin: auto;" /></p>
</div>
<ul>
<li><code>FDiv</code> representation: the gravity centers of <strong>vertices</strong> (i.e. species with the most extreme functional traits) of each assemblages are plotted as a square and a triangle. The two colored circles represent the mean distance of species to the gravity center for each assemblage. Species of each assemblage have different size given their relative weight into the assemblage.</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>plots_alpha</span><span class='op'>$</span><span class='st'>"fdiv"</span><span class='op'>$</span><span class='st'>"patchwork"</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/unnamed-chunk-22-1.png" width="1920" style="display: block; margin: auto;" /></p>
</div>
<ul>
<li><code>FSpe</code> representation: colored traits represent distances of each species from a given assemblage to the center of gravity of the global pool (i.e center of the functional space). the center of gravity is plotted with a purple diamond. Species of each assemblage have different size given their relative weight into the assemblage.</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>plots_alpha</span><span class='op'>$</span><span class='st'>"fspe"</span><span class='op'>$</span><span class='st'>"patchwork"</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/unnamed-chunk-23-1.png" width="1920" style="display: block; margin: auto;" /></p>
</div>
<ul>
<li><code>FDis</code> representation: colored traits represent distances of each species from a given assemblage to the center of gravity of species of the assemblage (defined by FIde values). The center of gravity of each assemblage is plotted using a square and a triangle. Species of each assemblage havedifferent size given their relative weight into the assemblage.</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>plots_alpha</span><span class='op'>$</span><span class='st'>"fdis"</span><span class='op'>$</span><span class='st'>"patchwork"</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/unnamed-chunk-24-1.png" width="1920" style="display: block; margin: auto;" /></p>
</div>
<ul>
<li><code>FIde</code> representation:colored lines refer to the weighted average position of species of each assemblage along each axis. Species of each assemblage have different size given their relative weight into the assemblage.</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>plots_alpha</span><span class='op'>$</span><span class='st'>"fide"</span><span class='op'>$</span><span class='st'>"patchwork"</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/unnamed-chunk-25-1.png" width="1920" style="display: block; margin: auto;" /></p>
</div>
<p><strong>N.B.</strong> Using the <code>mFD</code> package, you can plot more than two assemblages but not with the <code>alpha.multidim.plot()</code> function. There are several specific functions for each step of the plot: build the background of the plot (<code>background.plot()</code>), plot the pool of species you are working on (<code>pool.plot()</code>), plot species from the studied assemblages (<code>species.plot()</code>) function and lastly plot the wanted metric using related function (<code>fric.plot()</code>, <code>fdiv.plot()</code>, <code>fide.plot()</code>,<code>fdis.plot()</code>, <code>feve.plot()</code>, <code>fnnd.plot()</code>, <code>fori.plot()</code>, <code>fspe.plot()</code>). Plots for different axes combination can be gathered into a single plot using the <code>panels.to.patchwork()</code> function.</p>
<p><br/></p>
<h2 id="computing-and-plotting-beta-fd-indices">2.2. Computing and plotting beta FD indices</h2>
<p><br/></p>
<p><strong>N.B.</strong> Some Mac OS X 10.15 may encounter some issues with the beta_*() functions.</p>
<p><code>mFD</code> package allows you to compute beta diversity indices for each assemblage pairs following <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/geb.12021">Villeger <em>et al.</em> 2013</a>. For that we will use the <code>mFD::beta.fd.multidim()</code> function. This function can compute two families of functional beta diversity indices, either <strong>Jaccard</strong> or <strong>Sorensen</strong>.</p>
<p>In this example, we will use Jaccard index. For each assemblages pair, the dissimilarity index is decomposed into two additive components: <strong>turnover</strong> and <strong>nestedness-resultant</strong>.</p>
<p><strong>NB</strong> The <strong>turnover</strong> component is the highest if there is no shared traits combination between the two assemblages. The <strong>nestedness</strong> component is the highest if one assemblage hosts a small subset of the functional strategies present in the other.</p>
<p>The <code>mFD::beta.fd.multidim()</code> function has the main following arguments:</p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>beta_fd_indices_fruits</span> <span class='op'>&lt;-</span> <span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/beta.fd.multidim.html'>beta.fd.multidim</a></span><span class='op'>(</span>
      sp_faxes_coord   <span class='op'>=</span> <span class='va'>sp_faxes_coord_fruits</span><span class='op'>[</span> , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"PC1"</span>, <span class='st'>"PC2"</span>, <span class='st'>"PC3"</span>, <span class='st'>"PC4"</span><span class='op'>)</span><span class='op'>]</span>,
      asb_sp_occ       <span class='op'>=</span> <span class='va'>asb_sp_fruits_occ</span>,
      check_input      <span class='op'>=</span> <span class='cn'>TRUE</span>,
      beta_family      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Jaccard"</span><span class='op'>)</span>,
      details_returned <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li><p><code>sp_faxes_coord</code> is the species coordinates matrix. This dataframe gathers <strong>only</strong> axis of the functional space you have chosen based on <strong>step 4</strong>.</p></li>
<li><p><code>asb_sp_occ</code> is the matrix of occurrence (coded as 0/1) of species assemblages (summarized in <strong>step 1</strong>).</p></li>
<li><p><code>check_input</code> is a recurrent argument in the <code>mFD</code> package. It defines whether inputs should be checked before computation or not. Possible error messages will thus be more understandable for the user than R error messages (<strong>Recommendation:</strong> set it as <code>TRUE</code>.</p></li>
<li><p><code>beta_family</code> a character string for the type of beta-diversity index to compute, it can either be <code>Jaccard</code> or <code>Sorensen</code>.</p></li>
<li><p><code>details_returned</code> is a logical value indicating whether details of outputs must be stored. It should be stored if you plan to use the graphical function to illustrate beta diversity indices thereafter.</p></li>
<li><p>There are also other arguments for parallelisation options. Check the function help file for more explanation.</p></li>
</ul>
<p><br /></p>
<p>The function returns a list containing:</p>
<ul>
<li>a dist object with beta indices values for each pair of assemblages:</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>beta_fd_indices_fruits</span><span class='op'>$</span><span class='st'>"pairasb_fbd_indices"</span>, <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$jac_diss
              basket_1     basket_2     basket_3     basket_4
basket_2  3.920303e-15                                       
basket_3  3.920303e-15 3.920303e-15                          
basket_4  9.654002e-01 9.654002e-01 9.654002e-01             
basket_5  9.654002e-01 9.654002e-01 9.654002e-01 0.000000e+00
basket_6  8.701848e-01 8.701848e-01 8.701848e-01 9.972695e-01
basket_7  8.701848e-01 8.701848e-01 8.701848e-01 9.972695e-01
basket_8  9.797030e-01 9.797030e-01 9.797030e-01 1.000000e+00
basket_9  9.797030e-01 9.797030e-01 9.797030e-01 1.000000e+00
basket_10 9.151338e-01 9.151338e-01 9.151338e-01 9.303584e-01
              basket_5     basket_6     basket_7     basket_8
basket_2                                                     
basket_3                                                     
basket_4                                                     
basket_5                                                     
basket_6  9.972695e-01                                       
basket_7  9.972695e-01 0.000000e+00                          
basket_8  1.000000e+00 1.000000e+00 1.000000e+00             
basket_9  1.000000e+00 1.000000e+00 1.000000e+00 0.000000e+00
basket_10 9.303584e-01 9.983508e-01 9.983508e-01 9.702788e-01
              basket_9
basket_2              
basket_3              
basket_4              
basket_5              
basket_6              
basket_7              
basket_8              
basket_9              
basket_10 9.702788e-01

$jac_turn
              basket_1     basket_2     basket_3     basket_4
basket_2  3.920303e-15                                       
basket_3  3.920303e-15 3.920303e-15                          
basket_4  4.320333e-01 4.320333e-01 4.320333e-01             
basket_5  4.320333e-01 4.320333e-01 4.320333e-01 0.000000e+00
basket_6  8.627528e-01 8.627528e-01 8.627528e-01 9.723344e-01
basket_7  8.627528e-01 8.627528e-01 8.627528e-01 9.723344e-01
basket_8  9.425331e-01 9.425331e-01 9.425331e-01 1.000000e+00
basket_9  9.425331e-01 9.425331e-01 9.425331e-01 1.000000e+00
basket_10 5.990146e-01 5.990146e-01 5.990146e-01 8.385233e-01
              basket_5     basket_6     basket_7     basket_8
basket_2                                                     
basket_3                                                     
basket_4                                                     
basket_5                                                     
basket_6  9.723344e-01                                       
basket_7  9.723344e-01 0.000000e+00                          
basket_8  1.000000e+00 1.000000e+00 1.000000e+00             
basket_9  1.000000e+00 1.000000e+00 1.000000e+00 0.000000e+00
basket_10 8.385233e-01 9.944208e-01 9.944208e-01 9.638833e-01
              basket_9
basket_2              
basket_3              
basket_4              
basket_5              
basket_6              
basket_7              
basket_8              
basket_9              
basket_10 9.638833e-01

$jac_nest
             basket_1    basket_2    basket_3    basket_4    basket_5
basket_2  0.000000000                                                
basket_3  0.000000000 0.000000000                                    
basket_4  0.533366944 0.533366944 0.533366944                        
basket_5  0.533366944 0.533366944 0.533366944 0.000000000            
basket_6  0.007431956 0.007431956 0.007431956 0.024935183 0.024935183
basket_7  0.007431956 0.007431956 0.007431956 0.024935183 0.024935183
basket_8  0.037169839 0.037169839 0.037169839 0.000000000 0.000000000
basket_9  0.037169839 0.037169839 0.037169839 0.000000000 0.000000000
basket_10 0.316119149 0.316119149 0.316119149 0.091835053 0.091835053
             basket_6    basket_7    basket_8    basket_9
basket_2                                                 
basket_3                                                 
basket_4                                                 
basket_5                                                 
basket_6                                                 
basket_7  0.000000000                                    
basket_8  0.000000000 0.000000000                        
basket_9  0.000000000 0.000000000 0.000000000            
basket_10 0.003930032 0.003930032 0.006395544 0.006395544</code></pre>
</div>
<ul>
<li>a list containing details such as inputs, vertices of the global pool and of each assemblage and FRic values for each assemblage</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>beta_fd_indices_fruits</span><span class='op'>$</span><span class='st'>"details"</span>
</code></pre>
</div>
<pre><code>$inputs
$inputs$sp_faxes_coord
                        PC1           PC2          PC3          PC4
apple          0.0055715265  0.0350421604 -0.097471237  0.022402932
apricot        0.0051324906  0.1993950375 -0.095659935  0.041498534
banana         0.4180172546 -0.1414728845  0.008086992  0.006165812
currant       -0.3278449659  0.0536374098  0.049052945 -0.076408888
blackberry    -0.3034346496  0.0526909897  0.049135314 -0.142658171
blueberry     -0.2815708070 -0.0866665191  0.051316336  0.112502412
cherry        -0.0180809780  0.2978695529 -0.029313202  0.111166444
grape         -0.2228504050  0.0885963887  0.225751135  0.190718259
grapefruit     0.1450603259 -0.0673074635 -0.119455606 -0.084037260
kiwifruit     -0.1550698937 -0.0814958746  0.005740138  0.086787104
lemon          0.1067949113  0.0007714157 -0.088895714 -0.207026513
lime           0.2079695595  0.0199956576  0.099157708 -0.266782185
litchi         0.2917434196  0.2537533311  0.202206065  0.041136776
mango          0.4393412201  0.0559467870 -0.054626734  0.119804224
melon         -0.1493941692 -0.2420723462 -0.151024241  0.070247222
orange         0.1236282949 -0.0086604744 -0.050235439 -0.046156784
passion_fruit  0.1101264243 -0.1062790540  0.342728218  0.031929461
peach          0.0351203321  0.1465415655 -0.199699124  0.049647666
pear          -0.0005886084  0.0297927029 -0.105703762  0.010290065
pineapple      0.1991811945 -0.4756825960  0.075904777  0.042696533
plum           0.0126064681  0.1989177835 -0.084010036  0.058965350
raspberry     -0.3070933066  0.0543878274  0.049178225 -0.156730076
strawberry    -0.2917242495 -0.0898440618  0.025237344 -0.047647147
tangerine      0.1039035285  0.0526165085  0.041894666 -0.048619225
water_melon   -0.1465449176 -0.2404738440 -0.149294834  0.080107453

$inputs$asb_sp_occ
          apple apricot banana currant blackberry blueberry cherry
basket_1      1       0      1       0          0         0      1
basket_2      1       0      1       0          0         0      1
basket_3      1       0      1       0          0         0      1
basket_4      1       0      0       0          0         0      0
basket_5      1       0      0       0          0         0      0
basket_6      1       0      1       0          0         0      0
basket_7      1       0      1       0          0         0      0
basket_8      0       0      0       1          1         1      1
basket_9      0       0      0       1          1         1      1
basket_10     1       1      0       0          0         0      0
          grape grapefruit kiwifruit lemon lime litchi mango melon
basket_1      0          0         0     1    0      0     0     1
basket_2      0          0         0     1    0      0     0     1
basket_3      0          0         0     1    0      0     0     1
basket_4      0          0         1     1    0      0     0     0
basket_5      0          0         1     1    0      0     0     0
basket_6      0          0         0     0    1      1     1     0
basket_7      0          0         0     0    1      1     1     0
basket_8      1          0         0     1    0      0     0     0
basket_9      1          0         0     1    0      0     0     0
basket_10     1          1         0     0    0      0     0     1
          orange passion_fruit peach pear pineapple plum raspberry
basket_1       0             1     0    1         0    0         0
basket_2       0             1     0    1         0    0         0
basket_3       0             1     0    1         0    0         0
basket_4       1             0     1    1         0    1         0
basket_5       1             0     1    1         0    1         0
basket_6       1             0     0    0         1    0         0
basket_7       1             0     0    0         1    0         0
basket_8       0             0     0    0         0    0         1
basket_9       0             0     0    0         0    0         1
basket_10      0             0     0    1         0    1         0
          strawberry tangerine water_melon
basket_1           1         0           0
basket_2           1         0           0
basket_3           1         0           0
basket_4           0         1           0
basket_5           0         1           0
basket_6           0         0           1
basket_7           0         0           1
basket_8           1         0           0
basket_9           1         0           0
basket_10          1         0           0


$pool_vertices
 [1] &quot;grape&quot;         &quot;lemon&quot;         &quot;water_melon&quot;   &quot;banana&quot;       
 [5] &quot;raspberry&quot;     &quot;cherry&quot;        &quot;blueberry&quot;     &quot;grapefruit&quot;   
 [9] &quot;melon&quot;         &quot;strawberry&quot;    &quot;peach&quot;         &quot;apricot&quot;      
[13] &quot;passion_fruit&quot; &quot;litchi&quot;        &quot;lime&quot;          &quot;pineapple&quot;    
[17] &quot;mango&quot;         &quot;currant&quot;      

$asb_FRic
   basket_1    basket_2    basket_3    basket_4    basket_5 
0.162830681 0.162830681 0.162830681 0.007880372 0.007880372 
   basket_6    basket_7    basket_8    basket_9   basket_10 
0.147936148 0.147936148 0.036480112 0.036480112 0.025774304 

$asb_vertices
$asb_vertices$basket_1
[1] &quot;lemon&quot;         &quot;melon&quot;         &quot;pear&quot;          &quot;apple&quot;        
[5] &quot;passion_fruit&quot; &quot;cherry&quot;        &quot;strawberry&quot;    &quot;banana&quot;       

$asb_vertices$basket_2
[1] &quot;lemon&quot;         &quot;melon&quot;         &quot;pear&quot;          &quot;apple&quot;        
[5] &quot;passion_fruit&quot; &quot;cherry&quot;        &quot;strawberry&quot;    &quot;banana&quot;       

$asb_vertices$basket_3
[1] &quot;lemon&quot;         &quot;melon&quot;         &quot;pear&quot;          &quot;apple&quot;        
[5] &quot;passion_fruit&quot; &quot;cherry&quot;        &quot;strawberry&quot;    &quot;banana&quot;       

$asb_vertices$basket_4
[1] &quot;peach&quot;     &quot;lemon&quot;     &quot;tangerine&quot; &quot;pear&quot;      &quot;plum&quot;     
[6] &quot;orange&quot;    &quot;kiwifruit&quot;

$asb_vertices$basket_5
[1] &quot;peach&quot;     &quot;lemon&quot;     &quot;tangerine&quot; &quot;pear&quot;      &quot;plum&quot;     
[6] &quot;orange&quot;    &quot;kiwifruit&quot;

$asb_vertices$basket_6
[1] &quot;litchi&quot;      &quot;lime&quot;        &quot;apple&quot;       &quot;banana&quot;     
[5] &quot;orange&quot;      &quot;pineapple&quot;   &quot;mango&quot;       &quot;water_melon&quot;

$asb_vertices$basket_7
[1] &quot;litchi&quot;      &quot;lime&quot;        &quot;apple&quot;       &quot;banana&quot;     
[5] &quot;orange&quot;      &quot;pineapple&quot;   &quot;mango&quot;       &quot;water_melon&quot;

$asb_vertices$basket_8
[1] &quot;strawberry&quot; &quot;blueberry&quot;  &quot;raspberry&quot;  &quot;cherry&quot;     &quot;grape&quot;     
[6] &quot;lemon&quot;      &quot;currant&quot;   

$asb_vertices$basket_9
[1] &quot;strawberry&quot; &quot;blueberry&quot;  &quot;raspberry&quot;  &quot;cherry&quot;     &quot;grape&quot;     
[6] &quot;lemon&quot;      &quot;currant&quot;   

$asb_vertices$basket_10
[1] &quot;grape&quot;      &quot;melon&quot;      &quot;plum&quot;       &quot;apricot&quot;    &quot;grapefruit&quot;
[6] &quot;strawberry&quot;</code></pre>
</div>
<ul>
<li>a vector containing the <code>FRic</code> value for each assemblage retrieved through the <code>details_beta</code> list:</li>
</ul>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>beta_fd_indices_fruits</span><span class='op'>$</span><span class='st'>"details"</span><span class='op'>$</span><span class='st'>"asb_FRic"</span>
</code></pre>
</div>
<pre><code>   basket_1    basket_2    basket_3    basket_4    basket_5 
0.162830681 0.162830681 0.162830681 0.007880372 0.007880372 
   basket_6    basket_7    basket_8    basket_9   basket_10 
0.147936148 0.147936148 0.036480112 0.036480112 0.025774304 </code></pre>
</div>
<p><br /></p>
<ul>
<li>a list of vectors containing names of species being vertices of the convex hull for each assemblage retrieved through the <code>details_beta</code> list:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>beta_fd_indices_fruits</span><span class='op'>$</span><span class='st'>"details"</span><span class='op'>$</span><span class='st'>"asb_vertices"</span>
</code></pre>
</div>
<pre><code>$basket_1
[1] &quot;lemon&quot;         &quot;melon&quot;         &quot;pear&quot;          &quot;apple&quot;        
[5] &quot;passion_fruit&quot; &quot;cherry&quot;        &quot;strawberry&quot;    &quot;banana&quot;       

$basket_2
[1] &quot;lemon&quot;         &quot;melon&quot;         &quot;pear&quot;          &quot;apple&quot;        
[5] &quot;passion_fruit&quot; &quot;cherry&quot;        &quot;strawberry&quot;    &quot;banana&quot;       

$basket_3
[1] &quot;lemon&quot;         &quot;melon&quot;         &quot;pear&quot;          &quot;apple&quot;        
[5] &quot;passion_fruit&quot; &quot;cherry&quot;        &quot;strawberry&quot;    &quot;banana&quot;       

$basket_4
[1] &quot;peach&quot;     &quot;lemon&quot;     &quot;tangerine&quot; &quot;pear&quot;      &quot;plum&quot;     
[6] &quot;orange&quot;    &quot;kiwifruit&quot;

$basket_5
[1] &quot;peach&quot;     &quot;lemon&quot;     &quot;tangerine&quot; &quot;pear&quot;      &quot;plum&quot;     
[6] &quot;orange&quot;    &quot;kiwifruit&quot;

$basket_6
[1] &quot;litchi&quot;      &quot;lime&quot;        &quot;apple&quot;       &quot;banana&quot;     
[5] &quot;orange&quot;      &quot;pineapple&quot;   &quot;mango&quot;       &quot;water_melon&quot;

$basket_7
[1] &quot;litchi&quot;      &quot;lime&quot;        &quot;apple&quot;       &quot;banana&quot;     
[5] &quot;orange&quot;      &quot;pineapple&quot;   &quot;mango&quot;       &quot;water_melon&quot;

$basket_8
[1] &quot;strawberry&quot; &quot;blueberry&quot;  &quot;raspberry&quot;  &quot;cherry&quot;     &quot;grape&quot;     
[6] &quot;lemon&quot;      &quot;currant&quot;   

$basket_9
[1] &quot;strawberry&quot; &quot;blueberry&quot;  &quot;raspberry&quot;  &quot;cherry&quot;     &quot;grape&quot;     
[6] &quot;lemon&quot;      &quot;currant&quot;   

$basket_10
[1] &quot;grape&quot;      &quot;melon&quot;      &quot;plum&quot;       &quot;apricot&quot;    &quot;grapefruit&quot;
[6] &quot;strawberry&quot;</code></pre>
</div>
<p>Then, the package allows the user to illustrate functional beta-diversity indices for a pair of assemblages in a multidimensional space using the <code>mFD::beta.multidim.plot()</code> function. The output of this function is a figure showing the overlap between convex hulls shaping each of the two species assemblages.</p>
<p>The plotting function has a large number of arguments, allowing the user to chose graphical options. Only main arguments are listed below:</p>
<em>Code</em>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>beta_plot_fruits</span> <span class='op'>&lt;-</span> <span class='fu'>mFD</span><span class='fu'>::</span><span class='fu'><a href='https://cmlmagneville.github.io/mFD/reference/beta.multidim.plot.html'>beta.multidim.plot</a></span><span class='op'>(</span>
  output_beta_fd_multidim <span class='op'>=</span> <span class='va'>beta_fd_indices_fruits</span>,
  plot_asb_nm             <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"basket_1"</span>, <span class='st'>"basket_4"</span><span class='op'>)</span>,
  beta_family             <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Jaccard"</span><span class='op'>)</span>,
  plot_sp_nm              <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"apple"</span>, <span class='st'>"lemon"</span>, <span class='st'>"pear"</span><span class='op'>)</span>,
  faxes                   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"PC"</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span>,
  name_file               <span class='op'>=</span> <span class='cn'>NULL</span>,
  faxes_nm                <span class='op'>=</span> <span class='cn'>NULL</span>,
  range_faxes             <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='cn'>NA</span><span class='op'>)</span>,
  check_input             <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<ul>
<li><p><code>output_beta_fd_multidim</code> is the output of the <code>mFD::beta.fd.multidim()</code> function retrieved before as <code>beta_fd_indices</code>.</p></li>
<li><p><code>plot_asb_nm</code> is a vector containing the name of the two assemblages to plot. Here plots of indices will be shown for <em>basket_1</em> and <em>basket_4</em>.</p></li>
<li><p><code>beta_family</code> refers to the family of the plotted index. It must be the same as the family chosen to compute beta functional indices values with the <code>mFD::beta.fd.multidim()</code> function.</p></li>
<li><p><code>plot_sp_nm</code> is a vector containing the names of species the user want to plot, if any. If no the user does not want to plot any species name, then this argument must be set up to <code>NULL</code>. Here, <em>apple</em>, <em>cherry</em> and <em>lemon</em> will be plotted on the graph.</p></li>
<li><p><code>faxes</code> is a vector containing the names of the functional axes of the plotted functional space. Here, the figure will be plotted for <em>PC1</em>, <em>PC2</em> and <em>PC3</em>. This function allows you to plot between two and four axes for graphical reasons.</p></li>
<li><p><code>name_file</code> is a character string with the name of the file to save the figure (without extension). If the user does not want to save the file and only display it, this argument must be set up to <code>NULL</code>.</p></li>
<li><p><code>faxes_nm</code> is a vector containing the axes labels for the figure if the user wants to set up different labels than those contained in <code>faxes</code>.</p></li>
<li><p><code>range_faxes</code> is a vector with minimum and maximum values of functional axes. To have a fair representation of the position of species in all plots, axes should have the same range. If the user wants the range to be computed according to the range of values among all axes, this argument must be set up to <code>c(NA, NA)</code>.</p></li>
<li><p><code>check_input</code> is a recurrent argument in the <code>mFD</code> package. It defines whether inputs should be checked before computation or not. Possible error messages will thus be more understandable for the user than R error messages (<strong>Recommendation:</strong> set it as <code>TRUE</code>)</p></li>
<li><p>Others arguments to set up colors, shapes, sizes and, text fonts are also available. For more information about them, read the function help file.</p></li>
</ul>
<p>Then, the function returns each graph for each functional axes combination and also a multipanel plot with all combinations of axes and the graph caption. Here is the multipanel for the fruits exaample:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>beta_plot_fruits</span><span class='op'>$</span><span class='st'>"patchwork"</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/unnamed-chunk-32-1.png" width="1536" style="display: block; margin: auto;" /></p>
</div>
<p>For each assemblage, the associated convex hull is plotted in a different colour and indices values are printed on the right corner of the plot. Vertices of the convex hull of a given assemblage can be plotted with a different symbol such as in this example. Species of all assemblages are plotted with gray cross and the associated convex hull is plotted in white.</p>
<p><br/></p>
<h1 id="part-3.-functional-rarity">Part 3. Functional rarity</h1>
<p>In this part we’ll be using our built functional space to compute functional originality indices. The questions we’ll answer are:</p>
<ul>
<li>What are functionally distinct fruits compared to all fruits together?</li>
<li>Are some of these fruits distinct at regional scale but not when looking at specific baskets?</li>
</ul>
<h2 id="components-of-functional-rarity-trait-originality-and-rarity">3.1 Components of functional rarity: trait originality and rarity</h2>
<p>Functional originality indices (also named functional rarity indices) measures how different are the trait of a target species compared to other ones among a set. Their idea is analogous to the rarity concept in terms of abundance: some species are rare because they show low abundance, some are common because of their high abundance. Well, functionally original species are original because they display trait values distant from most other species.</p>
<p>The indices were initially proposed as complimentary facets: one for “classical” rarity and one for trait “rarity” (= originality) <a href="https://doi.org/10.1016/j.tree.2017.02.002">Violle <em>et al.</em> 2017</a>. With this framework, a species could be either rare or common, with either original or common traits. All combinations are possible. For example a species can be rare in abundance but have common traits. A species could also be common in abundance but original in terms of traits.</p>
<p>Violle <em>et al.</em> (<a href="https://doi.org/10.1016/j.tree.2017.02.002">2014</a>) further declined the framework along two spatial scales, local and regional. The local scale is scale of the site or the assemblage, where species interact directly. The regional scale is the species pools scale, containing all species occurring in a given set of assemblages.</p>
<p>This initial framework thus contained 16 different possibilities between the different kinds of rarity (trait or abundance) and the spatial scales.</p>
<p>More recent studies tend to focus only on the trait originality axis and that’s the one we’ll be studying here.</p>
<h2 id="different-indices-of-functional-originality">3.2 Different indices of functional originality</h2>
<p>One specificity of functional originality indices is that we compute them on a species basis and not per sites. This means that for each species we will get one value.</p>
<p>The two proposed indices of functional originality are <strong>functional distinctiveness</strong> (<em>Di</em>) and <strong>functional uniqueness</strong> (<em>Ui</em>). They were initially envisioned at different spatial scales, with functional distinctiveness computed at local scale (and considering abundance) while functional uniqueness was to be computed at regional scales (without considering abundances).</p>
<figure>
<img src="img/di_ui_scheme.jpg" alt="" /><figcaption><i class="fa fa-caret-right" role="presentation" aria-label="caret-right icon"></i>  Scheme showing how Distinctiveness (Di) and Uniqueness (Ui) are computed</figcaption>
</figure>
<p><strong>Functional distinctiveness</strong> is the mean of dissimilarity of the focal species to all the other species of the set of interest. It can be abundance-weighted if needed.</p>
<p><strong>Functional uniqueness</strong> is the smallest dissimilarity that exists between the focal species and the all other species in the set. It does not consider the abundance of any species.</p>
<h2 id="computing-functional-originality">3.3 Computing functional originality</h2>
<p>To compute functional originality indices we will two object: a functional dissimilarity matrix and a site-species matrix. We will be reusing the ones we defined in part 1 for that.</p>
<p>Because the <code>funrar</code> package follows strictly the framework defined by Violle <em>et al.</em> (2017), we have to consider the spatial scale at which we compute distinctiveness and uniqueness.</p>
<h3 id="at-regional-scale">3.3.1 At regional scale</h3>
<p>At regional scale, we can compute distinctiveness using the <code>distinctiveness_global()</code> function. The first argument should be a functional dissimilarity matrix and the second argument gives the name of the output column.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://rekyt.github.io/funrar/'>"funrar"</a></span><span class='op'>)</span>

<span class='va'>sp_di</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rekyt.github.io/funrar/reference/distinctiveness_global.html'>distinctiveness_global</a></span><span class='op'>(</span><span class='va'>sp_dist_fruits</span>, di_name <span class='op'>=</span> <span class='st'>"distinctiveness"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>sp_di</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>     species distinctiveness
1      apple       0.2930460
2    apricot       0.3421360
3     banana       0.4972814
4    currant       0.4496738
5 blackberry       0.4272436
6  blueberry       0.4264538</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>sp_di</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 25  2</code></pre>
</div>
<p>We get one value of distinctiveness per species. It only considers the functional dissimilarity of all species in the dissimilarity matrix without considering their spatial distributions. We get one value of distinctiveness per species.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>sp_di</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>sp_di</span><span class='op'>$</span><span class='va'>distinctiveness</span>, probs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, by <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>sp_di</span>, <span class='va'>distinctiveness</span> <span class='op'>&gt;=</span> <span class='fl'>0.48</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>When looking at the most distinct fruits we see that banana, litchi, and pineapple, are the most distinct from their characteristics.</p>
<p>For the choice or dissimilarity matrix we can use the raw dissimilarity matrix computed directly on raw traits values among species, as we did here. Another option would be to compute a new functional dissimilarity matrix based on the selected functional axes. One advantage of the latter is that it already takes into account the correlation between traits.</p>
<p>Let’s recompute regional functional distinctiveness based on the four selected functional axes. Because the space comes from a PCA, we can directly use euclidean distance.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>new_dissim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='va'>sp_faxes_coord_fruits</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"PC1"</span>, <span class='st'>"PC2"</span>, <span class='st'>"PC3"</span>, <span class='st'>"PC4"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>

<span class='va'>sp_di_alt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rekyt.github.io/funrar/reference/distinctiveness_global.html'>distinctiveness_global</a></span><span class='op'>(</span><span class='va'>new_dissim</span>, di_name <span class='op'>=</span> <span class='st'>"alt_di"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We can now compare both distinctiveness values.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sp_all_di</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>sp_di</span>, <span class='va'>sp_di_alt</span>, by <span class='op'>=</span> <span class='st'>"species"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>sp_all_di</span><span class='op'>$</span><span class='va'>distinctiveness</span>, <span class='va'>sp_all_di</span><span class='op'>$</span><span class='va'>alt_di</span><span class='op'>)</span>
</code></pre>
</div>
<img src="practice_files/figure-html5/di-comparison-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/cor.test.html'>cor.test</a></span><span class='op'>(</span><span class='va'>sp_all_di</span><span class='op'>$</span><span class='va'>distinctiveness</span>, <span class='va'>sp_all_di</span><span class='op'>$</span><span class='va'>alt_di</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
    Pearson&#39;s product-moment correlation

data:  sp_all_di$distinctiveness and sp_all_di$alt_di
t = 17.91, df = 23, p-value = 5.281e-15
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.9232161 0.9851024
sample estimates:
      cor 
0.9659697 </code></pre>
</div>
<p>Both seems very correlated, so in our case using either one should be fine. However, it can be better to use dissimilarity based on a reduced number of well-defined axes because: (1) there are more interpretable thanks to the multivariate analysis, (2) the first one contain de most information, (3) they explicitly take into account potentially strong correlations between provided traits. We’ll stick here with raw dissimilarity for the sake of simplicity.</p>
<p>To compute uniqueness at regional scale we also need the regional level functional dissimilarity matrix with the <code>uniqueness()</code> function, and the site-species matrix:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sp_ui</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rekyt.github.io/funrar/reference/uniqueness.html'>uniqueness</a></span><span class='op'>(</span>
  pres_matrix <span class='op'>=</span> <span class='va'>baskets_fruits_weights</span>,
  <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>sp_dist_fruits</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>sp_ui</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>sp_ui</span><span class='op'>$</span><span class='va'>Ui</span>, probs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, by <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>sp_ui</span>, <span class='va'>Ui</span> <span class='op'>&gt;=</span> <span class='fl'>0.21</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Note that we have to transform the dissimilarity object <code>sp_dist_fruits</code> into a matrix explicitly so that the function <code>uniqueness()</code> works.</p>
<p>Based on these results we see that banana, passion fruit, and pineapple are the most isolated fruits in the functional space. Meaning that they have the most distant nearest neighbors.</p>
<p>So we see that some species can be regionally distinct and regionally unique (banana and pineapple), while some can be not so regionally distinct but regionally unique (passion fruit).</p>
<h3 id="at-local-scale">3.3.2 At local scale</h3>
<p>At local scale we can use similar logic but we will obtain one value per species per site.</p>
<p>For distinctiveness we can use the <code>distinctiveness()</code> function:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sp_local_di</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rekyt.github.io/funrar/reference/distinctiveness.html'>distinctiveness</a></span><span class='op'>(</span>
  <span class='va'>baskets_fruits_weights</span>, <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>sp_dist_fruits</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='va'>sp_local_di</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>             apple apricot    banana currant blackberry blueberry
basket_1 0.1977721      NA 0.4642749      NA         NA        NA
basket_2 0.2852373      NA 0.5243089      NA         NA        NA
basket_3 0.2902663      NA 0.5219277      NA         NA        NA
basket_4 0.1136474      NA        NA      NA         NA        NA
basket_5 0.1393697      NA        NA      NA         NA        NA
basket_6 0.4138809      NA 0.3063492      NA         NA        NA</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>sp_local_di</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>baskets_fruits_weights</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
</div>
<p><strong>Note</strong>: because we provided a site-species matrix that contained “abundance” values (here the weights of the fruits in our baskets), the <code>distinctiveness()</code> is going to use them in its computation. If we want it not to consider abundances we need to convert the site-species matrix into a presence-absence matrix.</p>
<p>We get exactly the same number of sites and species as provided in the lists of baskets. Looking at the first column we see that the distinctiveness of apple varies a lot. Let’s see if can see how much it varies and why.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>sp_local_di</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code> basket_1  basket_2  basket_3  basket_4  basket_5  basket_6  basket_7 
0.1977721 0.2852373 0.2902663 0.1136474 0.1393697 0.4138809 0.3861698 
 basket_8  basket_9 basket_10 
       NA        NA 0.2313228 </code></pre>
</div>
<p>It varies from around 0.11 in basket 4 to up to 0.41 in basket 6. We can lookup the composition of these baskets to understand why:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>baskets_fruits_weights</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>6</span><span class='op'>)</span>,<span class='op'>]</span>
</code></pre>
</div>
<pre><code>         apple apricot banana currant blackberry blueberry cherry
basket_4   300       0      0       0          0         0      0
basket_6   100       0    200       0          0         0      0
         grape grapefruit kiwifruit lemon lime litchi mango melon
basket_4     0          0       100   100    0      0     0     0
basket_6     0          0         0     0  200    200   500     0
         orange passion_fruit peach pear pineapple plum raspberry
basket_4    400             0   300  400         0  200         0
basket_6    100             0     0    0       500    0         0
         strawberry tangerine water_melon
basket_4          0       200           0
basket_6          0         0         200</code></pre>
</div>
<p>We can see that basket 4 contains fruits of similar size, origin and sweetness of apples: peach, pear, plums. This decreases the local distinctiveness of apples. While basket 6 contains more tropical fruits that are quite different in terms of size and sugar from apples.</p>
<p>To compute uniqueness at the site scale, we must use a more complex expression as it was not envisioned for local computation:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>basket_ui</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span>
  <span class='va'>baskets_fruits_weights</span>, <span class='fl'>1</span>,
  <span class='kw'>function</span><span class='op'>(</span><span class='va'>single_site</span>, <span class='va'>dist_m</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>single_site</span> <span class='op'>=</span> <span class='va'>single_site</span><span class='op'>[</span><span class='va'>single_site</span> <span class='op'>&gt;</span> <span class='fl'>0</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>single_site</span><span class='op'>)</span><span class='op'>]</span>
    <span class='fu'><a href='https://rekyt.github.io/funrar/reference/uniqueness.html'>uniqueness</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>single_site</span><span class='op'>)</span><span class='op'>)</span>, <span class='va'>dist_m</span><span class='op'>)</span>
  <span class='op'>}</span>, dist_m <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>sp_dist_fruits</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>basket_ui</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$basket_1
        species          Ui
1         apple 0.008791209
2        banana 0.375274725
3        cherry 0.233379121
4         lemon 0.199587912
5         melon 0.190796703
6 passion_fruit 0.414148352
7          pear 0.008791209
8    strawberry 0.190796703</code></pre>
</div>
<p>As we had to manually build the function to compute the local uniqueness the results are strangely formatted.</p>
<p>We provide here a function that can help them to be more easily read:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>basket_ui</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>basket_ui</span><span class='op'>)</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>single_basket</span> <span class='op'>=</span> <span class='va'>basket_ui</span><span class='op'>[[</span><span class='va'>x</span><span class='op'>]</span><span class='op'>]</span>
  <span class='va'>single_basket</span><span class='op'>$</span><span class='va'>site</span> <span class='op'>=</span> <span class='va'>x</span>
  
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>single_basket</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>

<span class='va'>basket_ui</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span><span class='op'>(</span><span class='va'>rbind</span>, <span class='va'>basket_ui</span><span class='op'>)</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>]</span>
</code></pre>
</div>
</div>
<p>Then we can again look at the apple to see how its uniqueness varies across baskets.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>basket_ui</span>, <span class='va'>species</span> <span class='op'>==</span> <span class='st'>"apple"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>        site species          Ui
1   basket_1   apple 0.008791209
9   basket_2   apple 0.008791209
17  basket_3   apple 0.008791209
25  basket_4   apple 0.008791209
33  basket_5   apple 0.008791209
41  basket_6   apple 0.117170330
49  basket_7   apple 0.117170330
73 basket_10   apple 0.008791209</code></pre>
</div>
<p>We see that apple have the same uniqueness everywhere but in baskets 6 and 7. This means that it has the same nearest neighbor (in functional space) across all of these baskets. But that its closest neighbor is further away in baskets 6 and 7.</p>
<h2 id="plotting-functional-originality">3.4 Plotting functional originality</h2>
<p><code>funrar</code> does not come with visualization functions so that you can use whatever tool you prefer to plot the metrics. Here we are going to use <code>ggplot2</code> visualize the results. However, feel free to use anything plotting packages you would like. If you’re not fluent in <code>ggplot2</code> don’t worry this section will mostly be about interpreting the figures rather than commenting on code.</p>
<p>We already saw in part 1 how to visualize the functional space using the pre-made functions of <code>mFD</code>. Here we will use our own functions to be able to color species in function of their functional originality.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Make a summary data.frame</span>
<span class='va'>sp_coord_di_ui</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>sp_faxes_coord_fruits</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>sp_coord_di_ui</span><span class='op'>$</span><span class='va'>species</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>sp_coord_di_ui</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>sp_coord_di_ui</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>
<span class='va'>sp_coord_di_ui</span> <span class='op'>&lt;-</span> <span class='va'>sp_coord_di_ui</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>sp_coord_di_ui</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>sp_coord_di_ui</span>, <span class='va'>sp_di</span>, by <span class='op'>=</span> <span class='st'>"species"</span><span class='op'>)</span>
<span class='va'>sp_coord_di_ui</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>sp_coord_di_ui</span>, <span class='va'>sp_ui</span>, by <span class='op'>=</span> <span class='st'>"species"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://ggplot2.tidyverse.org'>"ggplot2"</a></span><span class='op'>)</span>

<span class='va'>plot_reg_distinctiveness</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>sp_coord_di_ui</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>PC1</span>, <span class='va'>PC2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fl'>0</span>, linetype <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span>, linetype <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>distinctiveness</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>species</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_viridis.html'>scale_color_viridis_c</a></span><span class='op'>(</span><span class='st'>"Functional\nDistinctiveness"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>aspect.ratio <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='va'>plot_reg_uniqueness</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>sp_coord_di_ui</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>PC1</span>, <span class='va'>PC2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fl'>0</span>, linetype <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span>, linetype <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Ui</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>species</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_viridis.html'>scale_color_viridis_c</a></span><span class='op'>(</span><span class='st'>"Functional\nUniqueness"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>aspect.ratio <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='fu'>patchwork</span><span class='fu'>::</span><span class='fu'><a href='https://patchwork.data-imaginist.com/reference/wrap_plots.html'>wrap_plots</a></span><span class='op'>(</span><span class='va'>plot_reg_distinctiveness</span>, <span class='va'>plot_reg_uniqueness</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="practice_files/figure-html5/funrar-plot-di-ui-regional-1.png" width="624" /></p>
</div>
<p>We can clearly see that, by definition, most functionally distinct species are on the edges of the functional space (pineapple, litchi, mango). If we compare both plots, we realize that functional distinctiveness doesn’t always come with functional uniqueness. One strange observation is that passion-fruit has a very functional uniqueness even though it seems quite in the middle of the points. This is a consequence of using the raw trait dissimilarity matrix instead of the projected axes. We’re are here visualizing the position of passion fruit in a 2D space while it should be considered in a 5D space, so it may seem close to other points in 2D while it is further away in reality.</p>
<p>As was done with <code>mFD</code> to correlate the functional axes with species’ traits we can correlate functional distinctiveness to specific traits in order to see which traits are mainly driving distinctiveness.</p>
<p>XXX</p>
<p>Regarding local level functional originality indices, the visualization can be more difficult to grasp and depends highly on the question. Would you rather focus on visualizing the functional distinctiveness of one species across communities? Compare the distribution of functional distinctiveness values across communities?</p>
<p>One idea to keep in mind is that averaging functional distinctiveness per community is exactly equal to computing functional dispersion. Functional originality is computed on a species basis, so we should be aware that if we are rather interested by community properties than we can compute functional diversity metrics which are much more appropriate.</p>
<p>If we take again our example of the apple we can see to what extent its functional distinctiveness varies across baskets compared to lemon.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>local_di_ap</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>sp_local_di</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>11</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>local_di_ap</span><span class='op'>$</span><span class='va'>basket</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>local_di_ap</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>You can of course then compute relationship between environmental covariates and functional originality values. Because we don’t have any covariable in our fruit baskets we will stop the plotting session here.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
